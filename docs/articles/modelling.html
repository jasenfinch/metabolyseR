<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modelling and feature selection • metabolyseR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Modelling and feature selection">
<meta property="og:description" content="metabolyseR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">metabolyseR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.14.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jasenfinch/metabolyseR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="modelling_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Modelling and feature selection</h1>
            <h3 class="subtitle">metabolyseR v0.14.3</h3>
                        <h4 class="author">Jasen Finch</h4>
            
            <h4 class="date">14 September, 2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jasenfinch/metabolyseR/blob/master/vignettes/modelling.Rmd"><code>vignettes/modelling.Rmd</code></a></small>
      <div class="hidden name"><code>modelling.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Modelling provides the essential data mining step for extracting biological information and explanatory metabolome features from a data set relating to the experimental conditions. <code>metabolyseR</code> provides a number of both univariate and multivariate methods for data mining.</p>
<p>For an introduction to the usage of <em>metabolyseR</em> for both exploratory and routine analyses, see the introduction vignette using:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html">vignette</a></span><span class="op">(</span><span class="st">'introduction'</span>,<span class="st">'metabolyseR'</span><span class="op">)</span></code></pre></div>
<p>To further supplement this document, a quick start example analysis is also available as a vignette:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html">vignette</a></span><span class="op">(</span><span class="st">'quick_start'</span>,<span class="st">'metabolyseR'</span><span class="op">)</span></code></pre></div>
<p>To begin, the package can be loaded using:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jasenfinch.github.io/metabolyseR">metabolyseR</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'metabolyseR'</span>
<span class="co">#&gt; The following object is masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     anova</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     raw, split</span></code></pre></div>
<div id="example-data" class="section level3">
<h3 class="hasAnchor">
<a href="#example-data" class="anchor"></a>Example data</h3>
<p>The examples used here will use the <code>abr1</code> data set from the <a href="https://aberhrml.github.io/metaboData/">metaboData</a> package. This is nominal mass flow-injection mass spectrometry (FI-MS) fingerprinting data from a plant-pathogen infection time course experiment. The pipe <code><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></code> from the <a href="https://magrittr.tidyverse.org/">magrittr</a> package will also be used. The example data can be loaded using:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://aberhrml.github.io/metaboData/">metaboData</a></span><span class="op">)</span></code></pre></div>
<p>Only the negative acquisition mode data (<code>abr1$neg</code>) will be used along with the sample meta-information (<code>abr1$fact</code>). Create an <code>AnalysisData</code> class object, assigned to the variable <code>d</code>, using the following:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analysisData.html">analysisData</a></span><span class="op">(</span><span class="va">abr1</span><span class="op">$</span><span class="va">neg</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">500</span><span class="op">]</span>,<span class="va">abr1</span><span class="op">$</span><span class="va">fact</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; AnalysisData object containing:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples: 120 </span>
<span class="co">#&gt; Features: 500 </span>
<span class="co">#&gt; Info: 9</span></code></pre></div>
<p>As can be seen above the data set contains a total of 120 samples and 500 features.</p>
</div>
<div id="parallel-processing" class="section level3">
<h3 class="hasAnchor">
<a href="#parallel-processing" class="anchor"></a>Parallel processing</h3>
<p>The package supports parallel processing using the <a href="https://CRAN.R-project.org/package=future">future</a> package.</p>
<p>By default, processing by <code>metabolyseR</code> will be done seqentially. However, parallel processing can be activated, prior to analysis, by specifying a parallel implementation using <code><a href="https://future.futureverse.org/reference/plan.html">plan()</a></code>. The following example specifies using the <code>multisession</code> implementation (muliple background R sessions) with two worker processes.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="fu">future</span><span class="fu">::</span><span class="va"><a href="https://future.futureverse.org/reference/multisession.html">multisession</a></span>,workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>See the future package <a href="https://CRAN.R-project.org/package=future">documentation</a> for more information on the types of parallel implementations that are available.</p>
</div>
</div>
<div id="random-forest" class="section level2">
<h2 class="hasAnchor">
<a href="#random-forest" class="anchor"></a>Random Forest</h2>
<p>Random forest is a versatile ensemble machine learning approach based on forests of decision trees for multivariate data mining. This can include <strong>unsupervised</strong> analysis, <strong>classification</strong> of discrete response variables and <strong>regression</strong> of continuous responses.</p>
<p>Random forest can be performed in <code>metabolyseR</code> using the <code><a href="../reference/randomForest.html">randomForest()</a></code> method. For further details on the arguments for using this function, see <code><a href="../reference/randomForest.html">?randomForest</a></code>. This implementation of random forest in <code>metabolyseR</code> utilises the <code>randomForest</code> package. See <code><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">?randomForest::randomForest</a></code> for more information about that implementation.</p>
<div id="unsupervised" class="section level3">
<h3 class="hasAnchor">
<a href="#unsupervised" class="anchor"></a>Unsupervised</h3>
<p>The unsupervised random forest approach can be useful starting point for analysis in any experimental context. It can be used to give a general overview of the structure of the data and to identify any possible problems. These could include situations such as the presence of outliers samples or splits in the data caused by the impact of analytical or sample preparation factors. Unsupervised random forest can have advantages in these assessments over other approaches such as Principle Component Analysis (PCA). It is less sensitive to the effect of a single feature that in fact could have little overall impact relative to the other hundreds that could be present in a data set.</p>
<p>The examples below will show the use of unsupervised random forest for assessing the general structure of the example data set and the presence of outlier samples.</p>
<p>Unsupervised random forest can be performed by setting the <code>cls</code> argument of <code><a href="../reference/randomForest.html">randomForest()</a></code> to <code>NULL</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">unsupervised_rf</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/randomForest.html">randomForest</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
<p>The type of random forest that has been performed can be checked using the <code>type</code> method.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/binaryComparisons.html">type</a></span><span class="op">(</span><span class="va">unsupervised_rf</span><span class="op">)</span>
<span class="co">#&gt; [1] "unsupervised"</span></code></pre></div>
<p>Or by printing the results object.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">unsupervised_rf</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Unsupervised random forest</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples:  120 </span>
<span class="co">#&gt; Features:     500</span></code></pre></div>
<p>Firstly, the presence of outlier samples will be assessed. A multidimensional scaling (MDS) plot can be used to visualise the relative proximity of the observations, as shown in the following. The individual points are also labelled by their injection order to enable the identification of individual samples if necessary.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotMDS.html">plotMDS</a></span><span class="op">(</span><span class="va">unsupervised_rf</span>,
        cls <span class="op">=</span> <span class="cn">NULL</span>,
        label <span class="op">=</span> <span class="st">'injorder'</span>,
        labelSize <span class="op">=</span> <span class="fl">3</span>,
        title <span class="op">=</span> <span class="st">'Outlier detection'</span><span class="op">)</span>
<span class="co">#&gt; Warning: ggrepel: 13 unlabeled data points (too many overlaps). Consider</span>
<span class="co">#&gt; increasing max.overlaps</span></code></pre></div>
<p><img src="modelling_files/figure-html/outlier-detect-1.png" width="700" style="display: block; margin: auto;"></p>
<p>From the plot above, it can be seen a single sample lies outside the 95% confidence ellipse. It is unlikely that this sample can be considered an outlier as it’s position is as a result of the underlying class structure as opposed to differences specific to that individual sample.</p>
<p>The structure of these observations can be investigated further by colouring the points by a different experimental factor. This will be by the <code>day</code> class column which is the main experimental factor of interest in this experiment.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotMDS.html">plotMDS</a></span><span class="op">(</span><span class="va">unsupervised_rf</span>,
        cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></code></pre></div>
<p><img src="modelling_files/figure-html/unsupervised-rf-1.png" width="700" style="display: block; margin: auto;"></p>
<p>This shows that it is indeed the experimental factor of interest that is having the greatest impact on the structure of the data. The progression of the experimental time points are obvious across Dimension 1.</p>
<p>The available feature importance metrics for a random forest analysis can be retrieved by:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/binaryComparisons.html">importanceMetrics</a></span><span class="op">(</span><span class="va">unsupervised_rf</span><span class="op">)</span>
<span class="co">#&gt; [1] "1"                    "2"                    "FalsePositiveRate"   </span>
<span class="co">#&gt; [4] "MeanDecreaseAccuracy" "MeanDecreaseGini"     "SelectionFrequency"</span></code></pre></div>
<p>And the importance values of these metrics for each feature can returned using:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/binaryComparisons.html">importance</a></span><span class="op">(</span><span class="va">unsupervised_rf</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 3,000 × 3</span>
<span class="co">#&gt;    Feature Metric                Value</span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;                 &lt;dbl&gt;</span>
<span class="co">#&gt;  1 N1      1                    0     </span>
<span class="co">#&gt;  2 N1      2                    0     </span>
<span class="co">#&gt;  3 N1      FalsePositiveRate    0.0238</span>
<span class="co">#&gt;  4 N1      MeanDecreaseAccuracy 0     </span>
<span class="co">#&gt;  5 N1      MeanDecreaseGini     0     </span>
<span class="co">#&gt;  6 N1      SelectionFrequency   0     </span>
<span class="co">#&gt;  7 N10     1                    0     </span>
<span class="co">#&gt;  8 N10     2                    0     </span>
<span class="co">#&gt;  9 N10     FalsePositiveRate    0.0238</span>
<span class="co">#&gt; 10 N10     MeanDecreaseAccuracy 0     </span>
<span class="co">#&gt; # … with 2,990 more rows</span></code></pre></div>
<p>The explanatory features for a given threshold can be extracted for any of the importance metrics. The following will extract the explanatory features below a threshold of 0.05 based on the false positive rate metric.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">unsupervised_rf</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/binaryComparisons.html">explanatoryFeatures</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="st">"FalsePositiveRate"</span>, 
                      threshold <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 359 × 3</span>
<span class="co">#&gt;    Feature Metric               Value</span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;                &lt;dbl&gt;</span>
<span class="co">#&gt;  1 N342    FalsePositiveRate 1.31e-19</span>
<span class="co">#&gt;  2 N161    FalsePositiveRate 2.34e-16</span>
<span class="co">#&gt;  3 N341    FalsePositiveRate 6.50e-16</span>
<span class="co">#&gt;  4 N315    FalsePositiveRate 1.79e-15</span>
<span class="co">#&gt;  5 N367    FalsePositiveRate 3.47e-14</span>
<span class="co">#&gt;  6 N173    FalsePositiveRate 9.09e-14</span>
<span class="co">#&gt;  7 N385    FalsePositiveRate 9.09e-14</span>
<span class="co">#&gt;  8 N133    FalsePositiveRate 1.52e-12</span>
<span class="co">#&gt;  9 N439    FalsePositiveRate 1.52e-12</span>
<span class="co">#&gt; 10 N379    FalsePositiveRate 3.78e-12</span>
<span class="co">#&gt; # … with 349 more rows</span></code></pre></div>
<p>In this example there are 359 explanatory features.</p>
<p>The trend of the most highly ranked explanatory feature against the <code>day</code> factor can be plotted using the <code><a href="../reference/plotFeature.html">plotFeature()</a></code> method.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">unsupervised_rf</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plotFeature.html">plotFeature</a></span><span class="op">(</span>feature <span class="op">=</span> <span class="st">'N425'</span>,
              cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></code></pre></div>
<p><img src="modelling_files/figure-html/unsupervised-feature-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div id="classification" class="section level3">
<h3 class="hasAnchor">
<a href="#classification" class="anchor"></a>Classification</h3>
<p>Random forest classification can be used to assess the extent of discrimination (difference) between classes of a discrete response variable. This includes both <strong>multinomial</strong> (number of classes &gt; 2) and <strong>binary</strong> (number of classes = 2) comparisons.</p>
<p>In multinomial situations, the suitability of a multinomial comparison versus multiple binary comparisons can depend on the experimental context. For instance, in a treatment/control experiment that includes multiple time points, a multinomial comparison using all available classes could be useful to visualise the general structure of the data. However, it could make any extracted explanatory features difficult to reason about as to how they relate to the individual experimental time point or treatment conditions. An investigator could instead identify the binary comparisons relevant to the biological question and focus the further classification comparisons to better select for explanatory features.</p>
<div id="multinomial-comparisons" class="section level4">
<h4 class="hasAnchor">
<a href="#multinomial-comparisons" class="anchor"></a>Multinomial comparisons</h4>
<p>In experiments with more than two classes, multinomial random forest classification can be used to assess the discrimination between the classes and give an overview of the relative structure between classes.</p>
<p>The example data set consists of a total of 6 classes for the <code>day</code> response variable.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/clsAdd.html">clsExtract</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] 2 3 4 1 H 5</span>
<span class="co">#&gt; Levels: 1 2 3 4 5 H</span></code></pre></div>
<p>Multinomial classification can be performed by:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">multinomial_rf</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/randomForest.html">randomForest</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">multinomial_rf</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Random forest classification </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples:  120 </span>
<span class="co">#&gt; Features:     500 </span>
<span class="co">#&gt; Response:     day </span>
<span class="co">#&gt; # comparisons:    1</span></code></pre></div>
<p>The performance of this model can be assessed using metrics based on the success of the out of bag (OOB) predictions. The performance metrics can be extracted using:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">multinomial_rf</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/binaryComparisons.html">metrics</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 4 × 5</span>
<span class="co">#&gt;   Response Comparison  .metric  .estimator .estimate</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt; 1 day      1~2~3~4~5~H accuracy multiclass     0.8  </span>
<span class="co">#&gt; 2 day      1~2~3~4~5~H kap      multiclass     0.76 </span>
<span class="co">#&gt; 3 day      1~2~3~4~5~H roc_auc  hand_till      0.964</span>
<span class="co">#&gt; 4 day      1~2~3~4~5~H margin   &lt;NA&gt;           0.146</span></code></pre></div>
<p>These metrics include <strong>accuracy</strong>, <strong>Cohen’s kappa</strong> (kap), <strong>area under the receiver operator characteristic curve</strong> (roc_auc, ROC-AUC) and <strong>margin</strong>. Each metric has both strengths and weaknesses that depend on the context of the classification such as the balance of observations between the classes. As shown below, the class frequencies for this example are balanced with 20 observations per class.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/clsAdd.html">clsExtract</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; .</span>
<span class="co">#&gt;  1  2  3  4  5  H </span>
<span class="co">#&gt; 20 20 20 20 20 20</span></code></pre></div>
<p>In this context, each of these metrics could be used to assess the predictive performance of the model. The margin metric is the difference between the proportion of votes for the correct class and the maximum proportion of votes for the other classes for a given observation which is then averaged across all the observations. A positive margin value indicates correct classification and values greater than 0.2 can be considered as the models having strong predictive power. The margin also allows the extent of discrimination to be discerned even in very distinct cases above where both the accuracy and ROC-AUC would be registering values of 1.</p>
<p>In this example, the values of all the metrics suggest that the model is showing good predictive performance. This can be investigated further by plotting the MDS of observation proximity values.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">multinomial_rf</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/plotMDS.html">plotMDS</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></code></pre></div>
<p><img src="modelling_files/figure-html/multinomial-mds-1.png" width="700" style="display: block; margin: auto;"></p>
<p>This shows that the model is able to discriminate highly between classes such as <code>5</code> and <code>H</code>. It is less able to discriminate more similar classes such as <code>H</code> and <code>1</code> or <code>4</code> and <code>5</code> whose confidence ellipses show a high degree of overlap. This makes sense in the context of this experiment as these are adjacent time points that are more likely to be similar than time points at each end of the experiment.</p>
<p>The ROC curves can also be plotted as shown below.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">multinomial_rf</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/plotROC.html">plotROC</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="modelling_files/figure-html/multinomial-roc-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Classes with their line further from the central dashed line are those that were predicted with the greatest reliability by the model. This plot shows that both the <code>H</code> and <code>1</code> classes were least reliably predicted which is a result of their close proximity shown in the MDS plot previously.</p>
<p>Importance metrics can be used to identify the metabolome features that contribute most to the class discrimination in the model. The available importance metrics for this model are shown below.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/binaryComparisons.html">importanceMetrics</a></span><span class="op">(</span><span class="va">multinomial_rf</span><span class="op">)</span>
<span class="co">#&gt;  [1] "1"                    "2"                    "3"                   </span>
<span class="co">#&gt;  [4] "4"                    "5"                    "FalsePositiveRate"   </span>
<span class="co">#&gt;  [7] "H"                    "MeanDecreaseAccuracy" "MeanDecreaseGini"    </span>
<span class="co">#&gt; [10] "SelectionFrequency"</span></code></pre></div>
<p>Here, we will use the false positive rate metric with a threshold of below 0.05 to identify explanatory features for the <code>day</code> response variable.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">multinomial_rf</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/binaryComparisons.html">explanatoryFeatures</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="st">'FalsePositiveRate'</span>,
                      threshold <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 121 × 5</span>
<span class="co">#&gt;    Response Comparison  Feature Metric               Value</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;                &lt;dbl&gt;</span>
<span class="co">#&gt;  1 day      1~2~3~4~5~H N341    FalsePositiveRate 1.02e-93</span>
<span class="co">#&gt;  2 day      1~2~3~4~5~H N133    FalsePositiveRate 7.38e-68</span>
<span class="co">#&gt;  3 day      1~2~3~4~5~H N163    FalsePositiveRate 3.59e-61</span>
<span class="co">#&gt;  4 day      1~2~3~4~5~H N439    FalsePositiveRate 1.07e-54</span>
<span class="co">#&gt;  5 day      1~2~3~4~5~H N342    FalsePositiveRate 3.19e-49</span>
<span class="co">#&gt;  6 day      1~2~3~4~5~H N377    FalsePositiveRate 3.19e-49</span>
<span class="co">#&gt;  7 day      1~2~3~4~5~H N171    FalsePositiveRate 6.26e-44</span>
<span class="co">#&gt;  8 day      1~2~3~4~5~H N497    FalsePositiveRate 6.11e-30</span>
<span class="co">#&gt;  9 day      1~2~3~4~5~H N146    FalsePositiveRate 2.74e-29</span>
<span class="co">#&gt; 10 day      1~2~3~4~5~H N195    FalsePositiveRate 7.16e-25</span>
<span class="co">#&gt; # … with 111 more rows</span></code></pre></div>
<p>As shown above there were a total of 121 explanatory features identified.</p>
<p>Within a multinomial experiment, it is also possible to specify the exact class comparisons to include, where it might not be suitable to compare all the classes at once using the <code>comparisons</code> argument. This should be specified as a named list, the corresponding to the <code>cls</code> argument. Each named element should then consist of a vector of comparisons, the classes to compare separated using the <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code>.</p>
<p>The following specifies two comparisons (<code>H~1~2</code>,<code>H~1~5</code>) for the <code>day</code> response variable and displays the performance metrics.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/randomForest.html">randomForest</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,
               comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'H~1~2'</span>,
                                          <span class="st">'H~1~5'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/binaryComparisons.html">metrics</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 8 × 5</span>
<span class="co">#&gt;   Response Comparison .metric  .estimator .estimate</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt; 1 day      H~1~2      accuracy multiclass     0.833</span>
<span class="co">#&gt; 2 day      H~1~2      kap      multiclass     0.75 </span>
<span class="co">#&gt; 3 day      H~1~5      accuracy multiclass     0.75 </span>
<span class="co">#&gt; 4 day      H~1~5      kap      multiclass     0.625</span>
<span class="co">#&gt; 5 day      H~1~2      roc_auc  hand_till      0.906</span>
<span class="co">#&gt; 6 day      H~1~5      roc_auc  hand_till      0.909</span>
<span class="co">#&gt; 7 day      H~1~2      margin   &lt;NA&gt;           0.172</span>
<span class="co">#&gt; 8 day      H~1~5      margin   &lt;NA&gt;           0.320</span></code></pre></div>
<p>The MDS and ROC curve plots can also be plotted simultaneously for the two comparisons.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/randomForest.html">randomForest</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,
               comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'H~1~2'</span>,
                                          <span class="st">'H~1~5'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="op">{</span><span class="fu"><a href="../reference/plotMDS.html">plotMDS</a></span><span class="op">(</span><span class="va">.</span>,cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="../reference/plotROC.html">plotROC</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">}</span></code></pre></div>
<p><img src="modelling_files/figure-html/classification-comparison-mds-roc-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Similarly, it is also possible to model multiple response factors with a single random forest call by specifying a vector of response class information column names to the <code>cls</code> argument. In the following, both the <code>name</code> and <code>day</code> response factors will be analysed and the performance metrics returned in a single table.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/randomForest.html">randomForest</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'name'</span>,<span class="st">'day'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/binaryComparisons.html">metrics</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Warning: Classes with &lt; 5 replicates removed: "11_3", "11_4", "11_5", "11_6",</span>
<span class="co">#&gt; "11_H", "12_1", "12_3", "12_6", "12_H", "13_1", "13_2", "13_3", "13_5", "13_6",</span>
<span class="co">#&gt; "13_H", "14_2", "14_3", "14_5", "14_6", "14_H", "15_1", "15_2", "15_4", "15_5",</span>
<span class="co">#&gt; "15_6", "15_H"</span>
<span class="co">#&gt; Unbalanced classes detected. Stratifying sample size to the smallest class size.</span>
<span class="co">#&gt; # A tibble: 8 × 5</span>
<span class="co">#&gt;   Response Comparison                    .metric  .estimator .estimate</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;                         &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt; 1 name     11_2~12_2~12_4~13_4~14_4~15_3 accuracy multiclass    0.35  </span>
<span class="co">#&gt; 2 name     11_2~12_2~12_4~13_4~14_4~15_3 kap      multiclass    0.212 </span>
<span class="co">#&gt; 3 name     11_2~12_2~12_4~13_4~14_4~15_3 roc_auc  hand_till     0.753 </span>
<span class="co">#&gt; 4 name     11_2~12_2~12_4~13_4~14_4~15_3 margin   &lt;NA&gt;         -0.0485</span>
<span class="co">#&gt; 5 day      1~2~3~4~5~H                   accuracy multiclass    0.8   </span>
<span class="co">#&gt; 6 day      1~2~3~4~5~H                   kap      multiclass    0.76  </span>
<span class="co">#&gt; 7 day      1~2~3~4~5~H                   roc_auc  hand_till     0.964 </span>
<span class="co">#&gt; 8 day      1~2~3~4~5~H                   margin   &lt;NA&gt;          0.146</span></code></pre></div>
<p>The MDS plots can also be returned for both models simultaneously.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/randomForest.html">randomForest</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'name'</span>,<span class="st">'day'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plotMDS.html">plotMDS</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Warning: Classes with &lt; 5 replicates removed: "11_3", "11_4", "11_5", "11_6",</span>
<span class="co">#&gt; "11_H", "12_1", "12_3", "12_6", "12_H", "13_1", "13_2", "13_3", "13_5", "13_6",</span>
<span class="co">#&gt; "13_H", "14_2", "14_3", "14_5", "14_6", "14_H", "15_1", "15_2", "15_4", "15_5",</span>
<span class="co">#&gt; "15_6", "15_H"</span>
<span class="co">#&gt; Unbalanced classes detected. Stratifying sample size to the smallest class size.</span></code></pre></div>
<p><img src="modelling_files/figure-html/multinomial-multiple-mds-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div id="binary-comparisons" class="section level4">
<h4 class="hasAnchor">
<a href="#binary-comparisons" class="anchor"></a>Binary comparisons</h4>
<p>It may in some cases be preferable to analyse class comparisons as multiple binary comparisons.</p>
<p>The possible binary comparisons for a given response variable can be displayed using the <code><a href="../reference/binaryComparisons.html">binaryComparisons()</a></code> method. Below shows the 15 comparisons for the <code>day</code> response variable.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/binaryComparisons.html">binaryComparisons</a></span><span class="op">(</span><span class="va">d</span>,cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span>
<span class="co">#&gt;  [1] "1~2" "1~3" "1~4" "1~5" "1~H" "2~3" "2~4" "2~5" "2~H" "3~4" "3~5" "3~H"</span>
<span class="co">#&gt; [13] "4~5" "4~H" "5~H"</span></code></pre></div>
<p>For this example we will only use the binary comparisons containing the <code>H</code> class.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binary_comparisons</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/binaryComparisons.html">binaryComparisons</a></span><span class="op">(</span><span class="va">d</span>,cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="va">.</span><span class="op">[</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">.</span>,<span class="st">'H'</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<p>The binary comparisons can then be performed using the following.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binary_rf</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/randomForest.html">randomForest</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,
               comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>day <span class="op">=</span> <span class="va">binary_comparisons</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">binary_rf</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Random forest classification </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples:  120 </span>
<span class="co">#&gt; Features:     500 </span>
<span class="co">#&gt; Response:     day </span>
<span class="co">#&gt; # comparisons:    5</span></code></pre></div>
<p>To run all possible binary comparisons, the <code>binary = TRUE</code> argument could instead be used.</p>
<p>The MDS plots for each comparison can be visualised to inspect the comparisons.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binary_rf</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/plotMDS.html">plotMDS</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></code></pre></div>
<p><img src="modelling_files/figure-html/binary-mds-1.png" width="700" style="display: block; margin: auto;"></p>
<p>These plots show good separation in all the comparisons except <code>H~1</code> which is also shown by the plot of the performance metrics below. Each of the comparisons are showing perfect performance for the accuracy, Cohen’s kappa and ROC-AUC metrics as well as very high margin values except for the <code>H~1</code> comparison.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binary_rf</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/plotMetrics.html">plotMetrics</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="modelling_files/figure-html/binary-metrics-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The explanatory features for these comparisons can be extracted as below using the false positive rate metric and a cut-off threshold of 0.05. This gives a total of 251 explanatory features.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binary_rf</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/binaryComparisons.html">explanatoryFeatures</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="st">'FalsePositiveRate'</span>,
                      threshold <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 251 × 5</span>
<span class="co">#&gt;    Response Comparison Feature Metric               Value</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;                &lt;dbl&gt;</span>
<span class="co">#&gt;  1 day      2~H        N341    FalsePositiveRate 7.34e-52</span>
<span class="co">#&gt;  2 day      2~H        N439    FalsePositiveRate 1.80e-45</span>
<span class="co">#&gt;  3 day      3~H        N342    FalsePositiveRate 2.71e-39</span>
<span class="co">#&gt;  4 day      2~H        N327    FalsePositiveRate 1.06e-35</span>
<span class="co">#&gt;  5 day      3~H        N439    FalsePositiveRate 1.06e-35</span>
<span class="co">#&gt;  6 day      2~H        N477    FalsePositiveRate 1.60e-34</span>
<span class="co">#&gt;  7 day      3~H        N377    FalsePositiveRate 1.60e-34</span>
<span class="co">#&gt;  8 day      4~H        N477    FalsePositiveRate 7.40e-34</span>
<span class="co">#&gt;  9 day      2~H        N447    FalsePositiveRate 6.48e-30</span>
<span class="co">#&gt; 10 day      3~H        N163    FalsePositiveRate 6.48e-30</span>
<span class="co">#&gt; # … with 241 more rows</span></code></pre></div>
<p>A heatmap of these explanatory features can be plotted to show their mean relative intensities across the experiment time points. Here, the classes are also refactored to customise the order of the classes on the x-axis.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">refactor_cls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clsAdd.html">clsExtract</a></span><span class="op">(</span><span class="va">binary_rf</span>,
                           cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">.</span>,levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'H'</span>,<span class="st">'1'</span>,<span class="st">'2'</span>,<span class="st">'3'</span>,<span class="st">'4'</span>,<span class="st">'5'</span><span class="op">)</span><span class="op">)</span>

<span class="va">binary_rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clsAdd.html">clsReplace</a></span><span class="op">(</span><span class="va">binary_rf</span>,
                        value <span class="op">=</span> <span class="va">refactor_cls</span>,
                        cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span>
<span class="va">binary_rf</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/plotExplanatoryHeatmap.html">plotExplanatoryHeatmap</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="st">'FalsePositiveRate'</span>,
                      threshold <span class="op">=</span> <span class="fl">0.05</span>,
                      featureNames <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="modelling_files/figure-html/binary-heatmap-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="regression" class="section level3">
<h3 class="hasAnchor">
<a href="#regression" class="anchor"></a>Regression</h3>
<p>Random forest regression can be used to assess the extent of association of the metabolomic data with continuous response variables.</p>
<p>In this example, the extent of association of injection order with the example data will be assessed.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">regression_rf</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/randomForest.html">randomForest</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'injorder'</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">regression_rf</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Random forest regression </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples:  120 </span>
<span class="co">#&gt; Features:     500 </span>
<span class="co">#&gt; Response:     injorder</span></code></pre></div>
<p>The regression model performance metrics, based on the OOB prediction error, can be extracted using the following:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">regression_rf</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/binaryComparisons.html">metrics</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 5 × 4</span>
<span class="co">#&gt;   Response .metric .estimator .estimate</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt; 1 injorder rsq     standard       0.476</span>
<span class="co">#&gt; 2 injorder mae     standard      23.5  </span>
<span class="co">#&gt; 3 injorder mape    standard     154.   </span>
<span class="co">#&gt; 4 injorder rmse    standard      26.5  </span>
<span class="co">#&gt; 5 injorder ccc     standard       0.508</span></code></pre></div>
<p>These regression metrics include <strong>R<sup>2</sup></strong> (<code>rsq</code>), <strong>mean absolute error</strong> (<code>mae</code>), <strong>mean absolute percentage error</strong> (<code>mape</code>), <strong>root mean squared error</strong> (<code>rmse</code>) and the <strong>concordance correlation coefficient</strong> (<code>ccc</code>).</p>
<p>The R<sup>2</sup> and concordance correlation coefficient metrics suggest that there is some association of features with the injection order, although this is weak. This is in agreement with mean absolute error metric that shows that on average, the injection order could only be predicted to an accuracy of 23 injection order positions.</p>
<p>The MDS plot belows the relative proximities of the samples based on this injection order regression model. This shows that for the most part, there is little correspondence of the sample positions with their injection order. However, there is a small grouping of samples towards the end of the run around sample ~99 to 120. It suggests that there could have been some analytical issues, for certain features, towards the end of the mass spectral analytical run.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">regression_rf</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/plotMDS.html">plotMDS</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="cn">NULL</span>,
          ellipses <span class="op">=</span> <span class="cn">FALSE</span>,
          label <span class="op">=</span> <span class="st">'injorder'</span>,
          labelSize <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt; Warning: ggrepel: 40 unlabeled data points (too many overlaps). Consider</span>
<span class="co">#&gt; increasing max.overlaps</span></code></pre></div>
<p><img src="modelling_files/figure-html/regression-mds-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The available feature importance metrics for this regression model can be listed.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">regression_rf</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/binaryComparisons.html">importanceMetrics</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "%IncMSE"       "IncNodePurity"</span></code></pre></div>
<p>The feature importance metrics can be plotted to give an overview of their distribution. The following will plot the <strong>percentage increase in the mean squared error</strong> (<code>%IncMSE</code>) importance metric.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">regression_rf</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/plotImportance.html">plotImportance</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="st">"%IncMSE"</span>, 
                 rank <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="modelling_files/figure-html/regression-importance-plot-1.png" width="700" style="display: block; margin: auto;"></p>
<p>This shows that there are only a few features that are contributing to the association with injection order. These explanatory features can be extracted with the following, using a threshold of above 5.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">regression_rf</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/binaryComparisons.html">explanatoryFeatures</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="st">'%IncMSE'</span>,
                      threshold <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 7 × 4</span>
<span class="co">#&gt;   Response Feature Metric  Value</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 injorder N283    %IncMSE 19.9 </span>
<span class="co">#&gt; 2 injorder N135    %IncMSE  8.71</span>
<span class="co">#&gt; 3 injorder N451    %IncMSE  5.58</span>
<span class="co">#&gt; 4 injorder N161    %IncMSE  5.51</span>
<span class="co">#&gt; 5 injorder N306    %IncMSE  5.49</span>
<span class="co">#&gt; 6 injorder N118    %IncMSE  5.22</span>
<span class="co">#&gt; 7 injorder N297    %IncMSE  5.07</span></code></pre></div>
<p>This returned a total of 7 explanatory features above this threshold. The top ranked feature <code>N283</code> can be plotted to investigate it’s trend in relation to injection order.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">regression_rf</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/plotFeature.html">plotFeature</a></span><span class="op">(</span>feature <span class="op">=</span> <span class="st">'N283'</span>,
              cls <span class="op">=</span> <span class="st">'injorder'</span><span class="op">)</span></code></pre></div>
<p><img src="modelling_files/figure-html/regression-feature-1.png" width="700" style="display: block; margin: auto;"></p>
<p>This shows an increase in the intensity of that feature for samples above 100 in the injection order which corresponds with the cluster that was seen in the MDS plot above.</p>
</div>
</div>
<div id="univariate-analyses" class="section level2">
<h2 class="hasAnchor">
<a href="#univariate-analyses" class="anchor"></a>Univariate analyses</h2>
<p>Univariate methods select features, explanatory for response variables, with features tested on an individual basis. These methods offer simplicity and easy interpretation in their use, however they provide no information as to how features may interact.</p>
<p>The univariate methods currently available in <code>metabolyseR</code> include Welch’s t-test, analysis of variance (ANOVA) and linear regression. The following sections will provide brief examples of the use of each of these methods.</p>
<div id="welchs-t-test" class="section level3">
<h3 class="hasAnchor">
<a href="#welchs-t-test" class="anchor"></a>Welch’s t-test</h3>
<p>Welch’s t-test can be used to select explanatory metabolome features for binary comparisons of discrete variables. By default, all the possible binary comparisons for the categories of a response variable will be tested.</p>
<p>Below shows the possible binary comparisons for the <code>day</code> response variable for the example data set.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/binaryComparisons.html">binaryComparisons</a></span><span class="op">(</span><span class="va">d</span>,
                  cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span>
<span class="co">#&gt;  [1] "1~2" "1~3" "1~4" "1~5" "1~H" "2~3" "2~4" "2~5" "2~H" "3~4" "3~5" "3~H"</span>
<span class="co">#&gt; [13] "4~5" "4~H" "5~H"</span></code></pre></div>
<p>For the following example, only a subset of comparisons will be tested. These will be selected by supplying a list to the <code>comparisons</code> argument.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ttest_analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ttest.html">ttest</a></span><span class="op">(</span><span class="va">d</span>,
                        cls <span class="op">=</span> <span class="st">'day'</span>,
                        comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'H~1'</span>,
                                                   <span class="st">'H~2'</span>,
                                                   <span class="st">'H~5'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ttest_analysis</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Univariate t-test analysis</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples:  120 </span>
<span class="co">#&gt; Features:     500 </span>
<span class="co">#&gt; Responses:    day </span>
<span class="co">#&gt; # comparisons:    3</span></code></pre></div>
<p>The explanatory features that show a significant difference between the response categories can be extracted as shown below.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/binaryComparisons.html">explanatoryFeatures</a></span><span class="op">(</span><span class="va">ttest_analysis</span>,
                    threshold <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 73 × 14</span>
<span class="co">#&gt;    Response Comparison Feature estimate estimate1 estimate2 statistic  p.value</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 day      H~5        N163      -735.       19.5   755.       -13.8  1.43e-11</span>
<span class="co">#&gt;  2 day      H~5        N341      2445.     2537.     92.6       13.6  2.88e-11</span>
<span class="co">#&gt;  3 day      H~5        N133      1055.     1077.     21.9       13.0  5.44e-11</span>
<span class="co">#&gt;  4 day      H~2        N341       200.      293.     92.6       10.6  1.38e-10</span>
<span class="co">#&gt;  5 day      H~5        N171        62.6      64.7     2.15      11.9  2.62e-10</span>
<span class="co">#&gt;  6 day      H~5        N119        17.2      17.9     0.763     11.0  8.54e-10</span>
<span class="co">#&gt;  7 day      H~5        N342       243.      247.      4.13      10.8  1.42e- 9</span>
<span class="co">#&gt;  8 day      H~5        N343        27.4      28.3     0.961      9.83 5.99e- 9</span>
<span class="co">#&gt;  9 day      H~5        N377       152.      157.      5.05       9.81 6.75e- 9</span>
<span class="co">#&gt; 10 day      H~5        N477       103.      129.     26.1        9.30 1.05e- 8</span>
<span class="co">#&gt; # … with 63 more rows, and 6 more variables: parameter &lt;dbl&gt;, conf.low &lt;dbl&gt;,</span>
<span class="co">#&gt; #   conf.high &lt;dbl&gt;, method &lt;chr&gt;, alternative &lt;chr&gt;, adjusted.p.value &lt;dbl&gt;</span></code></pre></div>
<p>This will threshold the features based on their adjusted p-value, found in the <code>adjusted.p.value</code> column of the table. The results of all of the features can be returned using the <code><a href="../reference/binaryComparisons.html">importance()</a></code> method.</p>
<p>A heat map of the explanatory features can be plotted to inspect the relative trends of the explanatory features in relation to the response <code>variable</code>.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotExplanatoryHeatmap.html">plotExplanatoryHeatmap</a></span><span class="op">(</span><span class="va">ttest_analysis</span><span class="op">)</span></code></pre></div>
<p><img src="modelling_files/figure-html/t-test-heatmap-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="anova" class="section level3">
<h3 class="hasAnchor">
<a href="#anova" class="anchor"></a>ANOVA</h3>
<p>ANOVA can be used to select explanatory features for discrete response variables with 3 or more categories. The following example will compare all the categories in the <code>day</code> response variable. However, the <code>comparisons</code> argument can be used to select particular comparisons of interest.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">anova_analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/anova.html">anova</a></span><span class="op">(</span><span class="va">d</span>,
                        cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">anova_analysis</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Univariate ANOVA analysis</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples:  120 </span>
<span class="co">#&gt; Features:     500 </span>
<span class="co">#&gt; Responses:    day </span>
<span class="co">#&gt; # comparisons:    1</span></code></pre></div>
<p>The explanatory features that are significantly different between the categories can then be extracted.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/binaryComparisons.html">explanatoryFeatures</a></span><span class="op">(</span><span class="va">anova_analysis</span>,
                    threshold <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 110 × 10</span>
<span class="co">#&gt;    Response Comparison  Feature term        df   sumsq meansq statistic  p.value</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 day      1~2~3~4~5~H N341    response     5  1.09e8 2.17e7     124.  1.90e-44</span>
<span class="co">#&gt;  2 day      1~2~3~4~5~H N163    response     5  1.25e7 2.51e6     113.  1.71e-42</span>
<span class="co">#&gt;  3 day      1~2~3~4~5~H N133    response     5  1.96e7 3.92e6     108.  1.71e-41</span>
<span class="co">#&gt;  4 day      1~2~3~4~5~H N171    response     5  6.29e4 1.26e4      88.8 1.16e-37</span>
<span class="co">#&gt;  5 day      1~2~3~4~5~H N342    response     5  1.04e6 2.07e5      85.1 7.61e-37</span>
<span class="co">#&gt;  6 day      1~2~3~4~5~H N343    response     5  1.19e4 2.38e3      66.1 4.43e-32</span>
<span class="co">#&gt;  7 day      1~2~3~4~5~H N119    response     5  4.92e3 9.83e2      53.8 2.07e-28</span>
<span class="co">#&gt;  8 day      1~2~3~4~5~H N497    response     5  1.10e5 2.20e4      49.6 4.83e-27</span>
<span class="co">#&gt;  9 day      1~2~3~4~5~H N137    response     5  6.32e3 1.26e3      39.9 1.59e-23</span>
<span class="co">#&gt; 10 day      1~2~3~4~5~H N277    response     5  6.31e4 1.26e4      39.1 3.14e-23</span>
<span class="co">#&gt; # … with 100 more rows, and 1 more variable: adjusted.p.value &lt;dbl&gt;</span></code></pre></div>
<p>The top ranked explanatory feature <code>N341</code> can be plotted to inspect it’s trend relative to the <code>day</code> response variable.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotFeature.html">plotFeature</a></span><span class="op">(</span><span class="va">anova_analysis</span>,
            feature <span class="op">=</span> <span class="st">'N341'</span>,
            cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></code></pre></div>
<p><img src="modelling_files/figure-html/anova-feature-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div id="linear-regression" class="section level3">
<h3 class="hasAnchor">
<a href="#linear-regression" class="anchor"></a>Linear regression</h3>
<p>Univariate linear regression can be used to associate a continuous response variable with metabolome features. In the example below, the example data will be regressed against injection order to identify any linearly associated metabolome features.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lr_analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/linearRegression.html">linearRegression</a></span><span class="op">(</span><span class="va">d</span>,
                                cls <span class="op">=</span> <span class="st">'injorder'</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">lr_analysis</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Univariate linear regression analysis</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples:  120 </span>
<span class="co">#&gt; Features:     500 </span>
<span class="co">#&gt; Responses:    injorder</span></code></pre></div>
<p>The explanatory features can then be extracted.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/binaryComparisons.html">explanatoryFeatures</a></span><span class="op">(</span><span class="va">lr_analysis</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 8 × 15</span>
<span class="co">#&gt;   Response Feature r.squared adj.r.squared sigma statistic  p.value    df logLik</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 injorder N283        0.310         0.304  4.27      53.0 4.10e-11     1  -343.</span>
<span class="co">#&gt; 2 injorder N135        0.165         0.157 78.7       23.2 4.31e- 6     1  -693.</span>
<span class="co">#&gt; 3 injorder N221        0.140         0.133  5.87      19.3 2.50e- 5     1  -382.</span>
<span class="co">#&gt; 4 injorder N473        0.135         0.127  7.24      18.3 3.78e- 5     1  -407.</span>
<span class="co">#&gt; 5 injorder N335        0.132         0.124 20.1       17.9 4.59e- 5     1  -529.</span>
<span class="co">#&gt; 6 injorder N452        0.120         0.112  4.00      16.0 1.10e- 4     1  -335.</span>
<span class="co">#&gt; 7 injorder N255        0.119         0.111 11.1       15.9 1.17e- 4     1  -458.</span>
<span class="co">#&gt; 8 injorder N267        0.118         0.111 26.4       15.8 1.22e- 4     1  -562.</span>
<span class="co">#&gt; # … with 6 more variables: AIC &lt;dbl&gt;, BIC &lt;dbl&gt;, deviance &lt;dbl&gt;,</span>
<span class="co">#&gt; #   df.residual &lt;int&gt;, nobs &lt;int&gt;, adjusted.p.value &lt;dbl&gt;</span></code></pre></div>
<p>The top ranked explanatory feature <code>N283</code> can be plotted to inspect inspects it’s association with injection order.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotFeature.html">plotFeature</a></span><span class="op">(</span><span class="va">lr_analysis</span>,
            feature <span class="op">=</span> <span class="st">'N283'</span>,
            cls <span class="op">=</span> <span class="st">'injorder'</span><span class="op">)</span></code></pre></div>
<p><img src="modelling_files/figure-html/linear-regression-feature-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="routine-analyses" class="section level2">
<h2 class="hasAnchor">
<a href="#routine-analyses" class="anchor"></a>Routine analyses</h2>
<p>For routine analyses, the initial analysis parameters for pre-treatment of the data and then the modelling can be selected.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analysisParameters.html">analysisParameters</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'pre-treatment'</span>,<span class="st">'modelling'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>More specific parameters for pre-treatment of the example data can be declared using the following.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/parameters.html">parameters</a></span><span class="op">(</span><span class="va">p</span>,<span class="st">'pre-treatment'</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/preTreatmentElements.html">preTreatmentParameters</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    keep <span class="op">=</span> <span class="st">'classes'</span>,
    occupancyFilter <span class="op">=</span> <span class="st">'maximum'</span>,
    transform <span class="op">=</span> <span class="st">'TICnorm'</span> 
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>The <code><a href="../reference/modellingMethods.html">modellingMethods()</a></code> function can be used to list the modelling methods that are currently available in <code>metabolyseR</code>.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/modellingMethods.html">modellingMethods</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "anova"            "ttest"            "linearRegression" "randomForest"</span></code></pre></div>
<p>The <code><a href="../reference/modellingMethods.html">modellingParameters()</a></code> function can be used to retrieve the default parameters for specific modelling methods. Below, the default modelling parameters for the <code>randomForest</code> and <code>ttest</code> methods are specified.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/parameters.html">parameters</a></span><span class="op">(</span><span class="va">p</span>,<span class="st">'modelling'</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modellingMethods.html">modellingParameters</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'randomForest'</span>,<span class="st">'ttest'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The class parameters can the be universily specified for both the pre-treatment and modelling elements. For this example, the <code>day</code> response variable will be used with just the <code>H</code> and <code>2</code> classes.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">changeParameter</span><span class="op">(</span><span class="va">p</span>,<span class="st">'cls'</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'day'</span>
<span class="fu">changeParameter</span><span class="op">(</span><span class="va">p</span>,<span class="st">'classes'</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'H'</span>,<span class="st">'2'</span><span class="op">)</span></code></pre></div>
<p>This gives the following parameters for the analysis.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span>
<span class="co">#&gt; Parameters:</span>
<span class="co">#&gt; pre-treatment</span>
<span class="co">#&gt;  keep</span>
<span class="co">#&gt;      classes</span>
<span class="co">#&gt;          cls = day</span>
<span class="co">#&gt;          classes = c("H", "2")</span>
<span class="co">#&gt;  occupancyFilter</span>
<span class="co">#&gt;      maximum</span>
<span class="co">#&gt;          cls = day</span>
<span class="co">#&gt;          occupancy = 2/3</span>
<span class="co">#&gt;  transform</span>
<span class="co">#&gt;      TICnorm</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; modelling</span>
<span class="co">#&gt;  randomForest</span>
<span class="co">#&gt;      cls = day</span>
<span class="co">#&gt;      rf = list()</span>
<span class="co">#&gt;      reps = 1</span>
<span class="co">#&gt;      binary = FALSE</span>
<span class="co">#&gt;      comparisons = list()</span>
<span class="co">#&gt;      perm = 0</span>
<span class="co">#&gt;      returnModels = FALSE</span>
<span class="co">#&gt;      seed = 1234</span>
<span class="co">#&gt;  ttest</span>
<span class="co">#&gt;      cls = day</span>
<span class="co">#&gt;      pAdjust = bonferroni</span>
<span class="co">#&gt;      comparisons = list()</span>
<span class="co">#&gt;      returnModels = FALSE</span></code></pre></div>
<p>The analysis can then be executed.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>analysis <span class="ot">&lt;-</span> <span class="fu">metabolyse</span>(abr1<span class="sc">$</span>neg,abr1<span class="sc">$</span>fact,p)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; metabolyseR  v0.14.3 Tue Sep 14 10:01:00 2021</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Parameters:</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; pre-treatment</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  keep</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      classes</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          cls = day</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          classes = c("H", "2")</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  occupancyFilter</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      maximum</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          cls = day</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          occupancy = 2/3</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  transform</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      TICnorm</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; modelling</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  randomForest</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      cls = day</span></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      rf = list()</span></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      reps = 1</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      binary = FALSE</span></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      comparisons = list()</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      perm = 0</span></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      returnModels = FALSE</span></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      seed = 1234</span></span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  ttest</span></span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      cls = day</span></span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      pAdjust = bonferroni</span></span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      comparisons = list()</span></span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      returnModels = FALSE</span></span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Pre-treatment …</span></span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>Pre<span class="sc">-</span>treatment   ✓ [<span class="fl">6.2</span>S]</span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Modelling …</span></span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a>Modelling   ✓ [<span class="fl">4.2</span>S]</span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Complete! [10.4S]</span></span></code></pre></div>
<p>The results for the modelling can be specifically extracted using the following.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/dat.html">analysisResults</a></span><span class="op">(</span><span class="va">analysis</span>,<span class="st">'modelling'</span><span class="op">)</span>
<span class="co">#&gt; $randomForest</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Random forest classification </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples:  40 </span>
<span class="co">#&gt; Features:     1713 </span>
<span class="co">#&gt; Response:     day </span>
<span class="co">#&gt; # comparisons:    1 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ttest</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Univariate t-test analysis</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples:  40 </span>
<span class="co">#&gt; Features:     1713 </span>
<span class="co">#&gt; Responses:    day </span>
<span class="co">#&gt; # comparisons:    1</span></code></pre></div>
<p>This returns the results as a list containing the modelling results objects for each specified method.</p>
<p>Alternatively, the modelling results can be assess directly from the <code>Analysis</code> object. Below shows the extraction of the explanatory features, using default parameters for each method, with the results returned in a single table.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">explanatory_features</span> <span class="op">&lt;-</span> <span class="va">analysis</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/binaryComparisons.html">explanatoryFeatures</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">explanatory_features</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 100 × 17</span>
<span class="co">#&gt;    Method       Response Comparison Feature Metric      Value estimate estimate1</span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 randomForest day      2~H        N341    FalsePo… 8.06e-28       NA        NA</span>
<span class="co">#&gt;  2 randomForest day      2~H        N377    FalsePo… 5.70e-18       NA        NA</span>
<span class="co">#&gt;  3 randomForest day      2~H        N447    FalsePo… 5.70e-18       NA        NA</span>
<span class="co">#&gt;  4 randomForest day      2~H        N579    FalsePo… 5.70e-18       NA        NA</span>
<span class="co">#&gt;  5 randomForest day      2~H        N1084   FalsePo… 1.19e-16       NA        NA</span>
<span class="co">#&gt;  6 randomForest day      2~H        N327    FalsePo… 2.33e-15       NA        NA</span>
<span class="co">#&gt;  7 randomForest day      2~H        N580    FalsePo… 4.32e-14       NA        NA</span>
<span class="co">#&gt;  8 randomForest day      2~H        N1083   FalsePo… 7.49e-13       NA        NA</span>
<span class="co">#&gt;  9 randomForest day      2~H        N1085   FalsePo… 7.49e-13       NA        NA</span>
<span class="co">#&gt; 10 randomForest day      2~H        N503    FalsePo… 7.49e-13       NA        NA</span>
<span class="co">#&gt; # … with 90 more rows, and 9 more variables: estimate2 &lt;dbl&gt;, statistic &lt;dbl&gt;,</span>
<span class="co">#&gt; #   p.value &lt;dbl&gt;, parameter &lt;dbl&gt;, conf.low &lt;dbl&gt;, conf.high &lt;dbl&gt;,</span>
<span class="co">#&gt; #   method &lt;chr&gt;, alternative &lt;chr&gt;, adjusted.p.value &lt;dbl&gt;</span></code></pre></div>
<p>Heat maps of the explanatory features can also be plotted for both the modelling methods.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotExplanatoryHeatmap.html">plotExplanatoryHeatmap</a></span><span class="op">(</span><span class="va">analysis</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html">wrap_plots</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="modelling_files/figure-html/explanatory-heatmap-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jasen Finch.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
