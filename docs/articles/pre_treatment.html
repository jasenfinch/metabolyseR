<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Metabolomics data pre-treatment • metabolyseR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Metabolomics data pre-treatment">
<meta property="og:description" content="metabolyseR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">metabolyseR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.13.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">metabolyseR</a>
    </li>
    <li>
      <a href="../articles/modelling.html">Modelling and feature selection</a>
    </li>
    <li>
      <a href="../articles/pre_treatment.html">Metabolomics data pre-treatment</a>
    </li>
    <li>
      <a href="../articles/quick_start.html">Quick start example analysis</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jasenfinch/metabolyseR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="pre_treatment_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="pre_treatment_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="pre_treatment_files/anchor-sections-1.0/anchor-sections.js"></script><script src="pre_treatment_files/kePrint-0.0.1/kePrint.js"></script><link href="pre_treatment_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Metabolomics data pre-treatment</h1>
            <h3 class="subtitle">metabolyseR v0.13.2</h3>
                        <h4 class="author">Jasen Finch</h4>
            
            <h4 class="date">02 November, 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jasenfinch/metabolyseR/blob/master/vignettes/pre_treatment.Rmd"><code>vignettes/pre_treatment.Rmd</code></a></small>
      <div class="hidden name"><code>pre_treatment.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Metabolomics data from any analytical technique requires various data pre-treatment steps prior to subsequent data mining or other downstream analyses and aids both data quality and integrity. It is important that appropriate pre-treatment strategies are used not only for the analytical technique being applied but are also suitable for the statistical or machine learning analyses that are to be utilised. Careful consideration of the pre-treatment steps to be undertaken are required as they can have substantial influence on the results and inferences taken from metabolomic analyses.</p>
<p>Data pre-treatment is the most faceted aspect of the analysis elements in <em>metabolyseR</em>. It itself is made up of a number of elements, which themselves are made up of methods. The following document will outline the application of each of these pre-treatment elements for use in exploratory analyses then outline how to apply them in routine analyses. For an introduction to the usage of <em>metabolyseR</em> for both exploratory and routine analyses, see the introduction vignette using:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/vignette.html">vignette</a></span><span class="op">(</span><span class="st">'introduction'</span>,<span class="st">'metabolyseR'</span><span class="op">)</span></pre></div>
<p>To further supplement this document, a quick start example analysis is also available as a vignette:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/vignette.html">vignette</a></span><span class="op">(</span><span class="st">'quick_start'</span>,<span class="st">'metabolyseR'</span><span class="op">)</span></pre></div>
<p>To begin, the package can be loaded using:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jasenfinch.github.io/metabolyseR">metabolyseR</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'metabolyseR'</span>
<span class="co">#&gt; The following object is masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     anova</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     raw, split</span></pre></div>
<div id="example-data" class="section level3">
<h3 class="hasAnchor">
<a href="#example-data" class="anchor"></a>Example data</h3>
<p>The examples used here will use the <code>abr1</code> data set from the <a href="https://github.com/aberHRML/metaboData">metaboData</a> package. This is nominal mass flow-injection mass spectrometry (FI-MS) fingerprinting data from a plant-pathogen infection time course experiment. The pipe <code><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></code> from the <a href="https://cran.r-project.org/web/packages/magrittr/index.html">magrittr</a> package will also be used. The example data can be loaded using:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/aberHRML/metaboData">metaboData</a></span><span class="op">)</span></pre></div>
<p>Only the negative acquisition mode data (<code>abr1$neg</code>) will be used along with the sample meta-information (<code>abr1$fact</code>). Create an <code>AnalysisData</code> class object, assigned to the variable <code>d</code>, using the following:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analysisData.html">analysisData</a></span><span class="op">(</span><span class="va">abr1</span><span class="op">$</span><span class="va">neg</span>,<span class="va">abr1</span><span class="op">$</span><span class="va">fact</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; AnalysisData object containing:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples: 120 </span>
<span class="co">#&gt; Features: 2000 </span>
<span class="co">#&gt; Info: 9</span></pre></div>
<p>As can be seen above the data set contains a total of 120 samples and 2000 features.</p>
</div>
</div>
<div id="pre-treatment-elements" class="section level2">
<h2 class="hasAnchor">
<a href="#pre-treatment-elements" class="anchor"></a>Pre-treatment elements</h2>
<p>The following sections will outline the numerous pre-treatment elements available within <em>metabolyseR</em>. There will be examples of their application during exploratory analyses along with useful visualisations that can aid interpretation of when particular treatments should be applied as well as the effect once they have been used.</p>
<div id="removal-of-samples-classes-or-features" class="section level3">
<h3 class="hasAnchor">
<a href="#removal-of-samples-classes-or-features" class="anchor"></a>Removal of samples, classes or features</h3>
<p>In many situations it will be necessary to exclude either individual samples, sample classes or certain features from further analysis.</p>
<p>Individual samples can be removed using <code>removeSamples</code> as below, where the <code>idx</code> argument stipulates the sample information column cotaining the sample indexes and the <code>samples</code> argument a vector of sample indexes to remove.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/removeSamples.html">removeSamples</a></span><span class="op">(</span>idx <span class="op">=</span> <span class="st">'injorder'</span>,samples <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; AnalysisData object containing:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples: 119 </span>
<span class="co">#&gt; Features: 2000 </span>
<span class="co">#&gt; Info: 9</span></pre></div>
<p>The <code>removeClasses</code> function can be used similarly to remove whole classes from further analysis:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/removeClasses.html">removeClasses</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,classes <span class="op">=</span> <span class="st">'H'</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; AnalysisData object containing:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples: 100 </span>
<span class="co">#&gt; Features: 2000 </span>
<span class="co">#&gt; Info: 9</span></pre></div>
<p>The following will enable the removal of specified features as a vector supplied to the <code>feautres</code> argument:</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/removeFeatures.html">removeFeatures</a></span><span class="op">(</span>features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'N1'</span>,<span class="st">'N2'</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; AnalysisData object containing:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples: 120 </span>
<span class="co">#&gt; Features: 1998 </span>
<span class="co">#&gt; Info: 9</span></pre></div>
<p>There maybe occasions where the numbers of samples, classes or features to remove are greater than the numbers of samples, classes or features that are to be retained. In these situations it will be more convenient to directly specify the samples, classes or features to retain. Keeping samples, classes or features is outlined in the following section.</p>
</div>
<div id="keeping-samples-classes-or-features" class="section level3">
<h3 class="hasAnchor">
<a href="#keeping-samples-classes-or-features" class="anchor"></a>Keeping samples, classes or features</h3>
<p>Often it will be necessary to retain only particular samples, sample classes or certain features for further analysis.</p>
<p>Individual samples can be kept using <code>keepSamples</code> as below, where the <code>idx</code> argument stipulates the sample information column cotaining the sample indexes and the <code>samples</code> argument, a vector of sample indexes to keep.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/keepSamples.html">keepSamples</a></span><span class="op">(</span>idx <span class="op">=</span> <span class="st">'injorder'</span>,samples <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; AnalysisData object containing:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples: 1 </span>
<span class="co">#&gt; Features: 2000 </span>
<span class="co">#&gt; Info: 9</span></pre></div>
<p>The <code>keepClasses</code> function can be used similarly to keep whole classes for further analysis:</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/keepClasses.html">keepClasses</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,classes <span class="op">=</span> <span class="st">'H'</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; AnalysisData object containing:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples: 20 </span>
<span class="co">#&gt; Features: 2000 </span>
<span class="co">#&gt; Info: 9</span></pre></div>
<p>The following will specify features to keep, with a vector of feature names supplied to the <code>features</code> argument:</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/keepFeatures.html">keepFeatures</a></span><span class="op">(</span>features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'N1'</span>,<span class="st">'N2'</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; AnalysisData object containing:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples: 120 </span>
<span class="co">#&gt; Features: 2 </span>
<span class="co">#&gt; Info: 9</span></pre></div>
<p>There are likely to be occasions where the numbers of samples, classes or features to keep are greater than the numbers of samples, classes or features that are to be excluded. In these situations it will be more convenient to directly specify the samples, classes or features to remove. Removing samples, classes or features is outlined in the previous section.</p>
</div>
<div id="variable-filtering-based-on-occupancy" class="section level3">
<h3 class="hasAnchor">
<a href="#variable-filtering-based-on-occupancy" class="anchor"></a>Variable filtering based on occupancy</h3>
<p>Occupancy provides a useful metric by which to filter poorly represented features (features containing a majority zero or missing values). An occupancy threshold provides a means of specifying this majority with variables below the threshold excluded from further analyses. However, this can be complicated by an underlying class structure present within the data where a variable may be well represented within one class but not in another.</p>
<p>The proportional occupancy for each feature within a data set for a given class structure can be calculated using the <code>occupancy</code> function, specifying the sample information column using the <code>cls</code> argument.</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/occupancy.html">occupancy</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 11,914 x 4</span>
<span class="co">#&gt;    day   Feature     N Occupancy</span>
<span class="co">#&gt;    &lt;fct&gt; &lt;chr&gt;   &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1     N1          0         0</span>
<span class="co">#&gt;  2 1     N10         0         0</span>
<span class="co">#&gt;  3 1     N100        0         0</span>
<span class="co">#&gt;  4 1     N1000      20         1</span>
<span class="co">#&gt;  5 1     N1001      20         1</span>
<span class="co">#&gt;  6 1     N1002      20         1</span>
<span class="co">#&gt;  7 1     N1003      20         1</span>
<span class="co">#&gt;  8 1     N1004      20         1</span>
<span class="co">#&gt;  9 1     N1005      20         1</span>
<span class="co">#&gt; 10 1     N1006      20         1</span>
<span class="co">#&gt; # … with 11,904 more rows</span></pre></div>
<p>Alternatively the occupancy distributions can be plotted providing a useful overview of the data set:</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plotOccupancy.html">plotOccupancy</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></pre></div>
<p><img src="pre_treatment_files/figure-html/plot_occupancy-1.png" width="700" style="display: block; margin: auto;"></p>
<p>It can be seen that there are a number of unoccupied features across all the sample classes with a small rise in the density distribution near 0.</p>
<p>There are two strategies for thresholding occupancy. The first is a maximum theshold; where the maximum occupancy across all classes is above the threshold. Therefore, for a feature to be retained, only a single class needs to have an occupancy above the threshold. It is this strategy that will be appropriate for most applications. A two-thirds maximum occupancy filter can be applied to the “day” sample information column of our data using:</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="va">maximum_occupancy_filtered</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">%&gt;%</span>
   <span class="fu"><a href="../reference/occupancyMaximum.html">occupancyMaximum</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,occupancy <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span></pre></div>
<p>It can be seen below that this removes 240 features.</p>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">maximum_occupancy_filtered</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; AnalysisData object containing:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples: 120 </span>
<span class="co">#&gt; Features: 1760 </span>
<span class="co">#&gt; Info: 9</span></pre></div>
<p>Plotting the occupancy distributions shows that all the low occupancy features have now been removed.</p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="va">maximum_occupancy_filtered</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plotOccupancy.html">plotOccupancy</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 6 rows containing non-finite values (stat_density).</span>
<span class="co">#&gt; Warning: Removed 6 row(s) containing missing values (geom_path).</span></pre></div>
<p><img src="pre_treatment_files/figure-html/plot_filtered_occupancy-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The alternative strategy is applying a minimum threshold; where the minimum occupancy across all classes is required to be above the freshold. Therefore, for a feautre to be retained, all classes would need to have an occupancy above the threshold. A two-thirds minimum occupancy filter can be applied to the “day” sample information column of our data using:</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="va">minimum_occupancy_filtered</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">%&gt;%</span>
   <span class="fu"><a href="../reference/occupancyMinimum.html">occupancyMinimum</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,occupancy <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span></pre></div>
<p>It can be seen below that this removes 344 features.</p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">minimum_occupancy_filtered</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; AnalysisData object containing:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples: 120 </span>
<span class="co">#&gt; Features: 1656 </span>
<span class="co">#&gt; Info: 9</span></pre></div>
</div>
<div id="data-transformation" class="section level3">
<h3 class="hasAnchor">
<a href="#data-transformation" class="anchor"></a>Data transformation</h3>
<p>Prior to downstream analyses, metabolomics data often require transformation to fulfill the assumptions of a particular statistical/data mining technique.</p>
<p>There are a wide range of transformation methods available that are commonly used for the analysis of metabolomics data. These methods are all named with the prefix <code>transform</code>.</p>
<p>The effects of a transformation on a data set can be assessed using a supervised classifcation approach. The following performs a supervised random forest analysis of the example data and plots the results using both multidimensional scaling (MDS) and reciever operator characteristic (ROC) curves.</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plotSupervisedRF.html">plotSupervisedRF</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></pre></div>
<p><img src="pre_treatment_files/figure-html/transform_RF-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Alternatively a log10 transformation can be applied prior to analysis:</p>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/transformLog10.html">transformLog10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plotSupervisedRF.html">plotSupervisedRF</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></pre></div>
<p><img src="pre_treatment_files/figure-html/log10_RF-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Or a total ion count (TIC) normalisation where each individual sample is corrected by its TIC. This is one method that can be used to account for small variablility in sample concentration.</p>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/transformTICnorm.html">transformTICnorm</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plotSupervisedRF.html">plotSupervisedRF</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></pre></div>
<p><img src="pre_treatment_files/figure-html/TICnorm_RF-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The margin value is a metric that can be used to assess model perfomance. Positive values indicate a models ability, on average, to correctly predict the class labels of the analysed data.</p>
<p>As can bee seen in the plots above, the transformations have little effect on the overall structure of the data set. However, there are small increases in the margins of the transformed data (model improvement) with the TIC normalised data having the highest. Note that here, a non-parametric machine learning approach has been applied to assess the effects of the transformations on the data. Using a different approach such as the parametric Analysis Of Varience (ANOVA) which different underlying assumptions will likely give diffent results to the assessment above.</p>
</div>
<div id="sample-aggregation" class="section level3">
<h3 class="hasAnchor">
<a href="#sample-aggregation" class="anchor"></a>Sample aggregation</h3>
<p>Metabolomic data can be aggregated using Sample aggregation allows the electronic pooling of samples based on a grouping variable. This is useful in situations such as the presence of technical replicates that can be aggregated to reduce the effects of pseudo replication.</p>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/occupancyMaximum.html">occupancyMaximum</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plotPCA.html">plotPCA</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></pre></div>
<p><img src="pre_treatment_files/figure-html/pca-1.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb24"><pre class="downlit">
<span class="va">day_mean</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/occupancyMaximum.html">occupancyMaximum</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/aggregateMean.html">aggregateMean</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit">
<span class="fu"><a href="../reference/plotPCA.html">plotPCA</a></span><span class="op">(</span><span class="va">day_mean</span>,cls <span class="op">=</span> <span class="st">'day'</span>,ellipses <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></pre></div>
<p><img src="pre_treatment_files/figure-html/day_mean_pca-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div id="batchblock-correction" class="section level3">
<h3 class="hasAnchor">
<a href="#batchblock-correction" class="anchor"></a>Batch/block correction</h3>
<p>There can sometimes be artificial batch related variability introduced introduced into metabolomics analyses as a result of analytical instrumentation or sample preparation. With appropriate sample randomisation (see section Variable filtering based on QC samples) batch related variability can be corrected for using the methods shown in the table below.</p>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plotTIC.html">plotTIC</a></span><span class="op">(</span>by <span class="op">=</span> <span class="st">'day'</span>,colour <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></pre></div>
<p><img src="pre_treatment_files/figure-html/day_TICs-1.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb27"><pre class="downlit">
<span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/correctionCenter.html">correctionCenter</a></span><span class="op">(</span>block <span class="op">=</span> <span class="st">'day'</span>,type <span class="op">=</span> <span class="st">'median'</span>,nCores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plotTIC.html">plotTIC</a></span><span class="op">(</span>by <span class="op">=</span> <span class="st">'day'</span>,colour <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></pre></div>
<p><img src="pre_treatment_files/figure-html/correction-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div id="imputation-of-missing-data" class="section level3">
<h3 class="hasAnchor">
<a href="#imputation-of-missing-data" class="anchor"></a>Imputation of missing data</h3>
<p>Missing values can have an important influence on downstream analyses with zero values heavily influencing the outcomes of parametric tests. Where and how they are imputed are important considerations and is highly related to variable occupancy. The methods provided here allow both these aspects to be taken into account and utilise Random Forest imputation using the <a href="https://CRAN.R-project.org/package=missForest"><em>missForest</em></a> package.</p>
<div class="sourceCode" id="cb28"><pre class="downlit">
<span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/keepClasses.html">keepClasses</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,classes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'H'</span>,<span class="st">'5'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/occupancyMaximum.html">occupancyMaximum</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,occupancy <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plotLDA.html">plotLDA</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></pre></div>
<p><img src="pre_treatment_files/figure-html/lda-1.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb29"><pre class="downlit">
<span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/keepClasses.html">keepClasses</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,classes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'H'</span>,<span class="st">'5'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/occupancyMaximum.html">occupancyMaximum</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,occupancy <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/imputeAll.html">imputeAll</a></span><span class="op">(</span>nCores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plotLDA.html">plotLDA</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></pre></div>
<p><img src="pre_treatment_files/figure-html/impute_all_lda-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Imputation accuracy is likely to be reduced if data is sparse or there is underlying class structure where there is significant discrimination.</p>
<div class="sourceCode" id="cb30"><pre class="downlit">
<span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/keepClasses.html">keepClasses</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,classes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'H'</span>,<span class="st">'5'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/occupancyMaximum.html">occupancyMaximum</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,occupancy <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/imputeClass.html">imputeClass</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,nCores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plotLDA.html">plotLDA</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></pre></div>
<p><img src="pre_treatment_files/figure-html/imputed_class_lda-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div id="feature-filtering-based-on-quality-control-qc-samples" class="section level3">
<h3 class="hasAnchor">
<a href="#feature-filtering-based-on-quality-control-qc-samples" class="anchor"></a>Feature filtering based on quality control (QC) samples</h3>
<p>A QC sample is an average pooled sample, equally representative in composition of all the samples present within an experimental set. Within an analytical run, the QC sample is analysed intermittently at equal intervals throughout the run. If there is class structure within the run this should be randomised within a block fashion so that the classes are equally represented in each block throughout the run. QC samples can then be injected between these randomised blocks. This provides a set of technical injections that allows the variability in instrument performance over the run to be accounted for and the robustness of the acquired variables to be assessed.</p>
<p>The technical reproducibility of an acquired variable can be assessed using it’s relative standard deviation (RSD) within the QC samples. The variable RSDs can then be thresholded to filter out variables that are poorly reproducible across the analytical runs. This variable filtering strategy has an advantage over that of occupancy alone as it is not dependent on underlying class structure. Therefore the variables and variable numbers will not alter if a new class structure is imposed upon the data.</p>
<p>The methods and arguments for variable filtering based upon QC samples are shown in the table below.</p>
<div class="sourceCode" id="cb31"><pre class="downlit">
<span class="va">QC</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/keepClasses.html">keepClasses</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,classes <span class="op">=</span> <span class="st">'H'</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit">
<span class="va">QC</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/rsd.html">rsd</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 2,000 x 3</span>
<span class="co">#&gt; # Groups:   day [1]</span>
<span class="co">#&gt;    day   Feature     RSD</span>
<span class="co">#&gt;    &lt;fct&gt; &lt;chr&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 H     N1      NaN    </span>
<span class="co">#&gt;  2 H     N10     NaN    </span>
<span class="co">#&gt;  3 H     N100    NaN    </span>
<span class="co">#&gt;  4 H     N1000     0.170</span>
<span class="co">#&gt;  5 H     N1001     0.217</span>
<span class="co">#&gt;  6 H     N1002     0.276</span>
<span class="co">#&gt;  7 H     N1003     0.219</span>
<span class="co">#&gt;  8 H     N1004     0.205</span>
<span class="co">#&gt;  9 H     N1005     0.179</span>
<span class="co">#&gt; 10 H     N1006     0.271</span>
<span class="co">#&gt; # … with 1,990 more rows</span></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit">
<span class="va">QC</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plotRSD.html">plotRSD</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 123 rows containing non-finite values (stat_density).</span>
<span class="co">#&gt; Warning: Removed 1 row(s) containing missing values (geom_path).</span></pre></div>
<p><img src="pre_treatment_files/figure-html/QC_rsd_plot-1.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb34"><pre class="downlit">
<span class="va">QC</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/occupancyMaximum.html">occupancyMaximum</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,occupancy <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plotRSD.html">plotRSD</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></pre></div>
<p><img src="pre_treatment_files/figure-html/QC_occupancy_rsd-1.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb35"><pre class="downlit">
<span class="va">QC_filtered</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/QCoccupancy.html">QCoccupancy</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,QCidx <span class="op">=</span> <span class="st">'H'</span>,occupancy <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/QCrsdFilter.html">QCrsdFilter</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,QCidx <span class="op">=</span> <span class="st">'H'</span>,RSDthresh <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">QC_filtered</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; AnalysisData object containing:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Samples: 120 </span>
<span class="co">#&gt; Features: 1363 </span>
<span class="co">#&gt; Info: 9</span></pre></div>
</div>
</div>
<div id="routine-analyses" class="section level2">
<h2 class="hasAnchor">
<a href="#routine-analyses" class="anchor"></a>Routine analyses</h2>
<p>The pre-treatment elements can be seen below.</p>
<div class="sourceCode" id="cb37"><pre class="downlit">
<span class="fu"><a href="../reference/preTreatmentElements.html">preTreatmentElements</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "aggregate"       "correction"      "impute"          "keep"           </span>
<span class="co">#&gt; [5] "occupancyFilter" "QC"              "remove"          "transform"</span></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit">
<span class="fu"><a href="../reference/preTreatmentMethods.html">preTreatmentMethods</a></span><span class="op">(</span><span class="st">'remove'</span><span class="op">)</span>
<span class="co">#&gt; [1] "classes"  "features" "samples"</span></pre></div>
<p>The parameter selection for the pre-treatment elements will firstly be discussed, with more in-depth discussion on the methods of the individual elements to follow.</p>
<div id="parameter-selection" class="section level3">
<h3 class="hasAnchor">
<a href="#parameter-selection" class="anchor"></a>Parameter Selection</h3>
<p>The default pre-treatment parameters can be seen below.</p>
<div class="sourceCode" id="cb39"><pre class="downlit">
<span class="fu"><a href="../reference/analysisParameters.html">analysisParameters</a></span><span class="op">(</span><span class="st">'pre-treatment'</span><span class="op">)</span>
<span class="co">#&gt; Parameters:</span>
<span class="co">#&gt; pre-treatment</span>
<span class="co">#&gt;  QC</span>
<span class="co">#&gt;      occupancyFilter</span>
<span class="co">#&gt;          cls = class</span>
<span class="co">#&gt;          QCidx = QC</span>
<span class="co">#&gt;          occupancy = 2/3</span>
<span class="co">#&gt;      impute</span>
<span class="co">#&gt;          cls = class</span>
<span class="co">#&gt;          QCidx = QC</span>
<span class="co">#&gt;          occupancy = 2/3</span>
<span class="co">#&gt;          parallel = variables</span>
<span class="co">#&gt;          nCores = detectCores() * 0.75</span>
<span class="co">#&gt;          clusterType = getClusterType()</span>
<span class="co">#&gt;          seed = 1234</span>
<span class="co">#&gt;      RSDfilter</span>
<span class="co">#&gt;          cls = class</span>
<span class="co">#&gt;          QCidx = QC</span>
<span class="co">#&gt;          RSDthresh = 0.5</span>
<span class="co">#&gt;      removeQC</span>
<span class="co">#&gt;          cls = class</span>
<span class="co">#&gt;          QCidx = QC</span>
<span class="co">#&gt;  occupancyFilter</span>
<span class="co">#&gt;      maximum</span>
<span class="co">#&gt;          cls = class</span>
<span class="co">#&gt;          occupancy = 2/3</span>
<span class="co">#&gt;  impute</span>
<span class="co">#&gt;      class</span>
<span class="co">#&gt;          cls = class</span>
<span class="co">#&gt;          occupancy = 2/3</span>
<span class="co">#&gt;          nCores = detectCores() * 0.75</span>
<span class="co">#&gt;          clusterType = getClusterType()</span>
<span class="co">#&gt;          seed = 1234</span>
<span class="co">#&gt;  transform</span>
<span class="co">#&gt;      TICnorm</span></pre></div>
<p>This pre-treatment analysis is made up of three elements that include variable filtering based on QC samples, missing data imputation and data transformation (<code>QC</code>, <code>impute</code> and <code>transform</code> respectively). Each of these elements is made up of varying numbers of methods, with each method having its own arguments. The order in which these elements and their methods is displayed is the order in which their execution upon the data will take place. This allows the fine specification of the data pre-treatment routines that are required for the particular data.</p>
<p>Pre-treatment routines can be customised by altering the <code>preTreat</code> slot within the <code>AnalysisParameters</code> object as shown below.</p>
<div class="sourceCode" id="cb40"><pre class="downlit">
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analysisParameters.html">analysisParameters</a></span><span class="op">(</span><span class="st">'pre-treatment'</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit">
<span class="fu"><a href="../reference/parameters.html">parameters</a></span><span class="op">(</span><span class="va">p</span>,<span class="st">'pre-treatment'</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/preTreatmentParameters.html">preTreatmentParameters</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    keep <span class="op">=</span> <span class="st">'classes'</span>,
    occupancyFilter <span class="op">=</span> <span class="st">'maximum'</span>,
    transform <span class="op">=</span> <span class="st">'TICnorm'</span> 
  <span class="op">)</span>
<span class="op">)</span></pre></div>
<div class="sourceCode" id="cb42"><pre class="downlit">
<span class="fu">changeParameter</span><span class="op">(</span><span class="va">p</span>,<span class="st">'cls'</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'day'</span>
<span class="fu">changeParameter</span><span class="op">(</span><span class="va">p</span>,<span class="st">'classes'</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'H'</span>,<span class="st">'1'</span>,<span class="st">'2'</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb43"><pre class="downlit">
<span class="va">p</span>
<span class="co">#&gt; Parameters:</span>
<span class="co">#&gt; pre-treatment</span>
<span class="co">#&gt;  keep</span>
<span class="co">#&gt;      classes</span>
<span class="co">#&gt;          cls = day</span>
<span class="co">#&gt;          classes = c("H", "1", "2")</span>
<span class="co">#&gt;  occupancyFilter</span>
<span class="co">#&gt;      maximum</span>
<span class="co">#&gt;          cls = day</span>
<span class="co">#&gt;          occupancy = 2/3</span>
<span class="co">#&gt;  transform</span>
<span class="co">#&gt;      TICnorm</span></pre></div>
<p>This routine will firstly remove a number of classes, filter the variables based on class occupancy and then transform the data using a total ion count normalisation.</p>
<p>The pre-treatment routines are specified as a hierarchy of lists within lists. Firstly the pre-treatment elements should be specified within a list with the particular element methods specified as lists within these. The method arguments are then declared within these lists. Empty lists for methods can be specified to use the default arguments; however, element lists should not be empty.</p>
<p>The pre-treatment routine can then be executed using the following.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>analysis &lt;-<span class="st"> </span><span class="kw">metabolyse</span>(abr1<span class="op">$</span>neg,abr1<span class="op">$</span>fact,p)</span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="co">#&gt; </span></span>
<span id="cb44-3"><a href="#cb44-3"></a><span class="co">#&gt; metabolyseR  v0.13.2 Mon Nov  2 15:47:10 2020</span></span>
<span id="cb44-4"><a href="#cb44-4"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb44-5"><a href="#cb44-5"></a><span class="co">#&gt; Parameters:</span></span>
<span id="cb44-6"><a href="#cb44-6"></a><span class="co">#&gt; pre-treatment</span></span>
<span id="cb44-7"><a href="#cb44-7"></a><span class="co">#&gt;  keep</span></span>
<span id="cb44-8"><a href="#cb44-8"></a><span class="co">#&gt;      classes</span></span>
<span id="cb44-9"><a href="#cb44-9"></a><span class="co">#&gt;          cls = day</span></span>
<span id="cb44-10"><a href="#cb44-10"></a><span class="co">#&gt;          classes = c("H", "1", "2")</span></span>
<span id="cb44-11"><a href="#cb44-11"></a><span class="co">#&gt;  occupancyFilter</span></span>
<span id="cb44-12"><a href="#cb44-12"></a><span class="co">#&gt;      maximum</span></span>
<span id="cb44-13"><a href="#cb44-13"></a><span class="co">#&gt;          cls = day</span></span>
<span id="cb44-14"><a href="#cb44-14"></a><span class="co">#&gt;          occupancy = 2/3</span></span>
<span id="cb44-15"><a href="#cb44-15"></a><span class="co">#&gt;  transform</span></span>
<span id="cb44-16"><a href="#cb44-16"></a><span class="co">#&gt;      TICnorm</span></span>
<span id="cb44-17"><a href="#cb44-17"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb44-18"><a href="#cb44-18"></a><span class="co">#&gt; Pre-treatment …</span></span>
<span id="cb44-19"><a href="#cb44-19"></a></span>
<span id="cb44-20"><a href="#cb44-20"></a>Pre<span class="op">-</span>treatment   ✓ [<span class="fl">9.2</span>S]</span>
<span id="cb44-21"><a href="#cb44-21"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb44-22"><a href="#cb44-22"></a><span class="co">#&gt; </span></span>
<span id="cb44-23"><a href="#cb44-23"></a><span class="co">#&gt; Complete! [9.2S]</span></span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="downlit">
<span class="va">analysis</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; metabolyseR v0.13.2</span>
<span class="co">#&gt; Analysis:</span>
<span class="co">#&gt;  Mon Nov  2 15:47:10 2020</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Raw Data:</span>
<span class="co">#&gt;      No. samples = 120</span>
<span class="co">#&gt;      No. features = 2000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Pre-treated Data:</span>
<span class="co">#&gt;      Mon Nov  2 15:47:19 2020</span>
<span class="co">#&gt;      No. samples = 60</span>
<span class="co">#&gt;      No. features = 1723</span></pre></div>
<div class="sourceCode" id="cb46"><pre class="downlit">
<span class="va">analysis</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plotSupervisedRF.html">plotSupervisedRF</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,type <span class="op">=</span> <span class="st">'pre-treated'</span><span class="op">)</span></pre></div>
<p><img src="pre_treatment_files/figure-html/unnamed-chunk-5-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div id="method-reference-table" class="section level3">
<h3 class="hasAnchor">
<a href="#method-reference-table" class="anchor"></a>Method reference table</h3>
<pre><code>#&gt; Warning in stri_c(..., sep = sep, collapse = collapse, ignore_null = TRUE):
#&gt; argument is not an atomic vector; coercing

#&gt; Warning in stri_c(..., sep = sep, collapse = collapse, ignore_null = TRUE):
#&gt; argument is not an atomic vector; coercing

#&gt; Warning in stri_c(..., sep = sep, collapse = collapse, ignore_null = TRUE):
#&gt; argument is not an atomic vector; coercing

#&gt; Warning in stri_c(..., sep = sep, collapse = collapse, ignore_null = TRUE):
#&gt; argument is not an atomic vector; coercing

#&gt; Warning in stri_c(..., sep = sep, collapse = collapse, ignore_null = TRUE):
#&gt; argument is not an atomic vector; coercing

#&gt; Warning in stri_c(..., sep = sep, collapse = collapse, ignore_null = TRUE):
#&gt; argument is not an atomic vector; coercing

#&gt; Warning in stri_c(..., sep = sep, collapse = collapse, ignore_null = TRUE):
#&gt; argument is not an atomic vector; coercing

#&gt; Warning in stri_c(..., sep = sep, collapse = collapse, ignore_null = TRUE):
#&gt; argument is not an atomic vector; coercing

#&gt; Warning in stri_c(..., sep = sep, collapse = collapse, ignore_null = TRUE):
#&gt; argument is not an atomic vector; coercing

#&gt; Warning in stri_c(..., sep = sep, collapse = collapse, ignore_null = TRUE):
#&gt; argument is not an atomic vector; coercing

#&gt; Warning in stri_c(..., sep = sep, collapse = collapse, ignore_null = TRUE):
#&gt; argument is not an atomic vector; coercing

#&gt; Warning in stri_c(..., sep = sep, collapse = collapse, ignore_null = TRUE):
#&gt; argument is not an atomic vector; coercing

#&gt; Warning in stri_c(..., sep = sep, collapse = collapse, ignore_null = TRUE):
#&gt; argument is not an atomic vector; coercing</code></pre>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Element
</th>
<th style="text-align:left;">
Method
</th>
<th style="text-align:left;">
Description
</th>
<th style="text-align:left;">
Arguments
</th>
<th style="text-align:left;">
Defaults
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: middle !important;" rowspan="3">
aggregate
</td>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
mean aggregate
</td>
<td style="text-align:left;">
cls - info column to use for aggregation index
</td>
<td style="text-align:left;">
cls = class
</td>
</tr>
<tr>
<td style="text-align:left;">
median
</td>
<td style="text-align:left;">
median aggregate
</td>
<td style="text-align:left;">
cls - info column to use for aggregation index
</td>
<td style="text-align:left;">
cls = class
</td>
</tr>
<tr>
<td style="text-align:left;">
sum
</td>
<td style="text-align:left;">
sum aggregate
</td>
<td style="text-align:left;">
cls - info column to use for aggregation index
</td>
<td style="text-align:left;">
cls = class
</td>
</tr>
<tr>
<td style="text-align:left;">
correction
</td>
<td style="text-align:left;">
center
</td>
<td style="text-align:left;">
Batch correction using average centering.
</td>
<td style="text-align:left;">
block - info column containing sample block groupings to use for correction; type - averaging to use; eg. mean or median; nCores - number of cores for parallisation; clusterType - cluster type for parallisation
</td>
<td style="text-align:left;">
block = block; type = median; nCores = detectCores() * 0.75; clusterType = getClusterType()
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: middle !important;" rowspan="2">
impute
</td>
<td style="text-align:left;">
all
</td>
<td style="text-align:left;">
Impute missing values across all samples using Random Forest
</td>
<td style="text-align:left;">
occupancy - occupancy threshold for imputation; parallel - parallel type to use. See <code>?missForest</code> for details; nCores - number of cores for parallisation; clusterType - cluster type for parallisation; seed - random number seed
</td>
<td style="text-align:left;">
occupancy = 2/3; parallel = variables; nCores = detectCores() * 0.75; clusterType = getClusterType(); seed = 1234
</td>
</tr>
<tr>
<td style="text-align:left;">
class
</td>
<td style="text-align:left;">
Impute missing values class-wise using Random Forest
</td>
<td style="text-align:left;">
cls - info column to use for class labels; occupancy - occupancy threshold for imputation; nCores - number of cores for parallisation; clusterType - cluster type for parallisation; seed - random number seed
</td>
<td style="text-align:left;">
cls = class; occupancy = 2/3; nCores = detectCores() * 0.75; clusterType = getClusterType(); seed = 1234
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: middle !important;" rowspan="3">
keep
</td>
<td style="text-align:left;">
classes
</td>
<td style="text-align:left;">
keep classes
</td>
<td style="text-align:left;">
cls - info column containing class information; classes - classes to keep
</td>
<td style="text-align:left;">
cls = class; classes = c()
</td>
</tr>
<tr>
<td style="text-align:left;">
features
</td>
<td style="text-align:left;">
keep features
</td>
<td style="text-align:left;">
features - features to keep
</td>
<td style="text-align:left;">
features = character()
</td>
</tr>
<tr>
<td style="text-align:left;">
samples
</td>
<td style="text-align:left;">
keep samples
</td>
<td style="text-align:left;">
idx - info column containing sample indexes; samples - sample indices to keep
</td>
<td style="text-align:left;">
idx = fileOrder; samples = c()
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: middle !important;" rowspan="2">
occupancyFilter
</td>
<td style="text-align:left;">
maximum
</td>
<td style="text-align:left;">
maximum thresholded class occupancy filtering
</td>
<td style="text-align:left;">
cls - info column to use for class labels; occupancy - occupancy threshold
</td>
<td style="text-align:left;">
cls = class; occupancy = 2/3
</td>
</tr>
<tr>
<td style="text-align:left;">
minimum
</td>
<td style="text-align:left;">
minimum thresholded class occupancy filtering
</td>
<td style="text-align:left;">
cls - info column to use for class labels; occupancy - occupancy threshold
</td>
<td style="text-align:left;">
cls = class; occupancy = 2/3
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: middle !important;" rowspan="4">
QC
</td>
<td style="text-align:left;">
impute
</td>
<td style="text-align:left;">
Impute missing values in QC samples
</td>
<td style="text-align:left;">
cls - info column to use for class labels; QCidx - QC sample label; occupancy - occupancy threshold for imputation; parallel - parallel type to use. See <code>?missForest</code> for details; nCores - number of cores for parallisation; clusterType - cluster type for parallisation; seed - random number seed
</td>
<td style="text-align:left;">
cls = class; QCidx = QC; occupancy = 2/3; parallel = variables; nCores = detectCores() * 0.75; clusterType = getClusterType(); seed = 1234
</td>
</tr>
<tr>
<td style="text-align:left;">
occupancyFilter
</td>
<td style="text-align:left;">
Filter variables based on occupancy in QC samples
</td>
<td style="text-align:left;">
cls - info column to use for class labels; QCidx - QC sample label; occupancy - occupancy threshold for filtering
</td>
<td style="text-align:left;">
cls = class; QCidx = QC; occupancy = 2/3
</td>
</tr>
<tr>
<td style="text-align:left;">
removeQC
</td>
<td style="text-align:left;">
Remove QC samples
</td>
<td style="text-align:left;">
cls - info column to use for class labels; QCidx - QC sample label
</td>
<td style="text-align:left;">
cls = class; QCidx = QC
</td>
</tr>
<tr>
<td style="text-align:left;">
RSDfilter
</td>
<td style="text-align:left;">
Filter features based on their relative standard deviation in QC samples
</td>
<td style="text-align:left;">
cls - info column to use for class labels; QCidx - QC sample label; RSDthreshold - RSD threshold for filtering
</td>
<td style="text-align:left;">
cls = class; QCidx = QC; RSDthresh = 0.5
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: middle !important;" rowspan="3">
remove
</td>
<td style="text-align:left;">
classes
</td>
<td style="text-align:left;">
remove classes
</td>
<td style="text-align:left;">
cls - info column containing class information; classes - classes to remove
</td>
<td style="text-align:left;">
cls = class; classes = c()
</td>
</tr>
<tr>
<td style="text-align:left;">
features
</td>
<td style="text-align:left;">
remove variables
</td>
<td style="text-align:left;">
features - features to remove
</td>
<td style="text-align:left;">
features = character()
</td>
</tr>
<tr>
<td style="text-align:left;">
samples
</td>
<td style="text-align:left;">
remove samples
</td>
<td style="text-align:left;">
idx - info column containing sample indexes; samples - sample indices to remove
</td>
<td style="text-align:left;">
idx = fileOrder; samples = c()
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: middle !important;" rowspan="11">
transform
</td>
<td style="text-align:left;">
asinh
</td>
<td style="text-align:left;">
Arc-sine scaling
</td>
<td style="text-align:left;">
’’ -
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
auto
</td>
<td style="text-align:left;">
Auto scaling
</td>
<td style="text-align:left;">
’’ -
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
center
</td>
<td style="text-align:left;">
Mean centering
</td>
<td style="text-align:left;">
’’ -
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
level
</td>
<td style="text-align:left;">
Level scaling
</td>
<td style="text-align:left;">
’’ -
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
ln
</td>
<td style="text-align:left;">
Natural log scaling
</td>
<td style="text-align:left;">
add - value to add prior to transformation
</td>
<td style="text-align:left;">
add = 1
</td>
</tr>
<tr>
<td style="text-align:left;">
log10
</td>
<td style="text-align:left;">
Log10 scaling
</td>
<td style="text-align:left;">
add - value to add prior to transformation
</td>
<td style="text-align:left;">
add = 1
</td>
</tr>
<tr>
<td style="text-align:left;">
pareto
</td>
<td style="text-align:left;">
Pareto scaling
</td>
<td style="text-align:left;">
’’ -
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
range
</td>
<td style="text-align:left;">
Range scaling
</td>
<td style="text-align:left;">
’’ -
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
sqrt
</td>
<td style="text-align:left;">
Square root scaling
</td>
<td style="text-align:left;">
’’ -
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
TICnorm
</td>
<td style="text-align:left;">
Total ion count normalisation
</td>
<td style="text-align:left;">
’’ -
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
vast
</td>
<td style="text-align:left;">
Vast scaling
</td>
<td style="text-align:left;">
’’ -
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jasen Finch.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
