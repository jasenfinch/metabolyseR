<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="metabolyseR">
<title>Modelling and feature selection • metabolyseR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Modelling and feature selection">
<meta property="og:description" content="metabolyseR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">metabolyseR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.15.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/metabolyseR.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/pre_treatment.html">Metabolomics data pre-treatment</a>
    <a class="dropdown-item" href="../articles/modelling.html">Modelling and feature selection</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jasenfinch/metabolyseR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Modelling and feature selection</h1>
            <h3 data-toc-skip class="subtitle">metabolyseR v0.15.2</h3>
                        <h4 data-toc-skip class="author">Jasen
Finch</h4>
            
            <h4 data-toc-skip class="date">14 August, 2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jasenfinch/metabolyseR/blob/HEAD/vignettes/modelling.Rmd" class="external-link"><code>vignettes/modelling.Rmd</code></a></small>
      <div class="d-none name"><code>modelling.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Modelling provides the essential data mining step for extracting
biological information and explanatory metabolome features from a data
set relating to the experimental conditions. <code>metabolyseR</code>
provides a number of both univariate and multivariate methods for data
mining.</p>
<p>For an introduction to the usage of <em>metabolyseR</em> for both
exploratory and routine analyses, see the introduction vignette
using:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">'introduction'</span>,<span class="st">'metabolyseR'</span><span class="op">)</span></span></code></pre></div>
<p>To further supplement this document, a quick start example analysis
is also available as a vignette:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">'quick_start'</span>,<span class="st">'metabolyseR'</span><span class="op">)</span></span></code></pre></div>
<p>To begin, the package can be loaded using:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jasenfinch.github.io/metabolyseR/">metabolyseR</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'metabolyseR'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     anova, predict</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     raw, split</span></span></code></pre></div>
<div class="section level3">
<h3 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h3>
<p>The examples used here will use the <code>abr1</code> data set from
the <a href="https://aberhrml.github.io/metaboData/" class="external-link">metaboData</a>
package. This is nominal mass flow-injection mass spectrometry (FI-MS)
fingerprinting data from a plant-pathogen infection time course
experiment. The pipe <code>%&gt;%</code> from the <a href="https://magrittr.tidyverse.org/" class="external-link">magrittr</a> package will also be
used. The example data can be loaded using:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://aberhrml.github.io/metaboData/" class="external-link">metaboData</a></span><span class="op">)</span></span></code></pre></div>
<p>Only the negative acquisition mode data (<code>abr1$neg</code>) will
be used along with the sample meta-information (<code>abr1$fact</code>).
Create an <code>AnalysisData</code> class object, assigned to the
variable <code>d</code>, using the following:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analysisData.html">analysisData</a></span><span class="op">(</span><span class="va">abr1</span><span class="op">$</span><span class="va">neg</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">500</span><span class="op">]</span>,<span class="va">abr1</span><span class="op">$</span><span class="va">fact</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; AnalysisData object containing:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples: 120 </span></span>
<span><span class="co">#&gt; Features: 500 </span></span>
<span><span class="co">#&gt; Info: 9</span></span></code></pre></div>
<p>As can be seen above the data set contains a total of 120 samples and
500 features.</p>
</div>
<div class="section level3">
<h3 id="parallel-processing">Parallel processing<a class="anchor" aria-label="anchor" href="#parallel-processing"></a>
</h3>
<p>The package supports parallel processing using the <a href="https://CRAN.R-project.org/package=future" class="external-link">future</a> package.</p>
<p>By default, processing by <code>metabolyseR</code> will be done
seqentially. However, parallel processing can be activated, prior to
analysis, by specifying a parallel implementation using
<code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan()</a></code>. The following example specifies using the
<code>multisession</code> implementation (muliple background R sessions)
with two worker processes.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future</span><span class="fu">::</span><span class="va"><a href="https://future.futureverse.org/reference/multisession.html" class="external-link">multisession</a></span>,workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>See the future package <a href="https://CRAN.R-project.org/package=future" class="external-link">documentation</a> for
more information on the types of parallel implementations that are
available.</p>
</div>
</div>
<div class="section level2">
<h2 id="random-forest">Random Forest<a class="anchor" aria-label="anchor" href="#random-forest"></a>
</h2>
<p>Random forest is a versatile ensemble machine learning approach based
on forests of decision trees for multivariate data mining. This can
include <strong>unsupervised</strong> analysis,
<strong>classification</strong> of discrete response variables and
<strong>regression</strong> of continuous responses.</p>
<p>Random forest can be performed in <code>metabolyseR</code> using the
<code><a href="../reference/randomForest.html">randomForest()</a></code> method. For further details on the arguments
for using this function, see <code><a href="../reference/randomForest.html">?randomForest</a></code>. This
implementation of random forest in <code>metabolyseR</code> utilises the
<code>randomForest</code> package. See
<code><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html" class="external-link">?randomForest::randomForest</a></code> for more information about that
implementation.</p>
<div class="section level3">
<h3 id="unsupervised">Unsupervised<a class="anchor" aria-label="anchor" href="#unsupervised"></a>
</h3>
<p>The unsupervised random forest approach can be useful starting point
for analysis in any experimental context. It can be used to give a
general overview of the structure of the data and to identify any
possible problems. These could include situations such as the presence
of outliers samples or splits in the data caused by the impact of
analytical or sample preparation factors. Unsupervised random forest can
have advantages in these assessments over other approaches such as
Principle Component Analysis (PCA). It is less sensitive to the effect
of a single feature that in fact could have little overall impact
relative to the other hundreds that could be present in a data set.</p>
<p>The examples below will show the use of unsupervised random forest
for assessing the general structure of the example data set and the
presence of outlier samples.</p>
<p>Unsupervised random forest can be performed by setting the
<code>cls</code> argument of <code><a href="../reference/randomForest.html">randomForest()</a></code> to
<code>NULL</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unsupervised_rf</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/randomForest.html">randomForest</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>The type of random forest that has been performed can be checked
using the <code>type</code> method.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/modelling-accessors.html">type</a></span><span class="op">(</span><span class="va">unsupervised_rf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "unsupervised"</span></span></code></pre></div>
<p>Or by printing the results object.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unsupervised_rf</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Unsupervised random forest</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples:  120 </span></span>
<span><span class="co">#&gt; Features:     500</span></span></code></pre></div>
<p>Firstly, the presence of outlier samples will be assessed. A
multidimensional scaling (MDS) plot can be used to visualise the
relative proximity of the observations, as shown in the following. The
individual points are also labelled by their injection order to enable
the identification of individual samples if necessary.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotMDS.html">plotMDS</a></span><span class="op">(</span><span class="va">unsupervised_rf</span>,</span>
<span>        cls <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        label <span class="op">=</span> <span class="st">'injorder'</span>,</span>
<span>        labelSize <span class="op">=</span> <span class="fl">3</span>,</span>
<span>        title <span class="op">=</span> <span class="st">'Outlier detection'</span><span class="op">)</span></span></code></pre></div>
<p><img src="modelling_files/figure-html/outlier-detect-1.png" width="700" style="display: block; margin: auto;"></p>
<p>From the plot above, it can be seen a single sample lies outside the
95% confidence ellipse. It is unlikely that this sample can be
considered an outlier as it’s position is as a result of the underlying
class structure as opposed to differences specific to that individual
sample.</p>
<p>The structure of these observations can be investigated further by
colouring the points by a different experimental factor. This will be by
the <code>day</code> class column which is the main experimental factor
of interest in this experiment.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotMDS.html">plotMDS</a></span><span class="op">(</span><span class="va">unsupervised_rf</span>,</span>
<span>        cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></span></code></pre></div>
<p><img src="modelling_files/figure-html/unsupervised-rf-1.png" width="700" style="display: block; margin: auto;"></p>
<p>This shows that it is indeed the experimental factor of interest that
is having the greatest impact on the structure of the data. The
progression of the experimental time points are obvious across Dimension
1.</p>
<p>The available feature importance metrics for a random forest analysis
can be retrieved by:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/modelling-accessors.html">importanceMetrics</a></span><span class="op">(</span><span class="va">unsupervised_rf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1"                    "2"                    "false_positive_rate" </span></span>
<span><span class="co">#&gt; [4] "MeanDecreaseAccuracy" "MeanDecreaseGini"     "selection_frequency"</span></span></code></pre></div>
<p>And the importance values of these metrics for each feature can
returned using:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/modelling-accessors.html">importance</a></span><span class="op">(</span><span class="va">unsupervised_rf</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3,000 × 3</span></span></span>
<span><span class="co">#&gt;    feature metric                value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> N1      1                    0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> N1      2                    0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> N1      MeanDecreaseAccuracy 0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> N1      MeanDecreaseGini     0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> N1      false_positive_rate  0.023<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> N1      selection_frequency  0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> N10     1                    0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> N10     2                    0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> N10     MeanDecreaseAccuracy 0     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> N10     MeanDecreaseGini     0     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2,990 more rows</span></span></span></code></pre></div>
<p>The explanatory features for a given threshold can be extracted for
any of the importance metrics. The following will extract the
explanatory features below a threshold of 0.05 based on the false
positive rate metric.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unsupervised_rf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/modelling-accessors.html">explanatoryFeatures</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="st">"false_positive_rate"</span>, </span>
<span>                      threshold <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 359 × 3</span></span></span>
<span><span class="co">#&gt;    feature metric                 value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> N342    false_positive_rate 1.31<span style="color: #949494;">e</span><span style="color: #BB0000;">-19</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> N161    false_positive_rate 2.34<span style="color: #949494;">e</span><span style="color: #BB0000;">-16</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> N341    false_positive_rate 6.50<span style="color: #949494;">e</span><span style="color: #BB0000;">-16</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> N315    false_positive_rate 1.79<span style="color: #949494;">e</span><span style="color: #BB0000;">-15</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> N367    false_positive_rate 3.47<span style="color: #949494;">e</span><span style="color: #BB0000;">-14</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> N173    false_positive_rate 9.09<span style="color: #949494;">e</span><span style="color: #BB0000;">-14</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> N385    false_positive_rate 9.09<span style="color: #949494;">e</span><span style="color: #BB0000;">-14</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> N133    false_positive_rate 1.52<span style="color: #949494;">e</span><span style="color: #BB0000;">-12</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> N439    false_positive_rate 1.52<span style="color: #949494;">e</span><span style="color: #BB0000;">-12</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> N379    false_positive_rate 3.78<span style="color: #949494;">e</span><span style="color: #BB0000;">-12</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 349 more rows</span></span></span></code></pre></div>
<p>In this example there are 359 explanatory features.</p>
<p>The trend of the most highly ranked explanatory feature against the
<code>day</code> factor can be plotted using the
<code><a href="../reference/plotFeature.html">plotFeature()</a></code> method.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unsupervised_rf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/plotFeature.html">plotFeature</a></span><span class="op">(</span>feature <span class="op">=</span> <span class="st">'N425'</span>,</span>
<span>              cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></span></code></pre></div>
<p><img src="modelling_files/figure-html/unsupervised-feature-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="classification">Classification<a class="anchor" aria-label="anchor" href="#classification"></a>
</h3>
<p>Random forest classification can be used to assess the extent of
discrimination (difference) between classes of a discrete response
variable. This includes both <strong>multinomial</strong> (number of
classes &gt; 2) and <strong>binary</strong> (number of classes = 2)
comparisons.</p>
<p>In multinomial situations, the suitability of a multinomial
comparison versus multiple binary comparisons can depend on the
experimental context. For instance, in a treatment/control experiment
that includes multiple time points, a multinomial comparison using all
available classes could be useful to visualise the general structure of
the data. However, it could make any extracted explanatory features
difficult to reason about as to how they relate to the individual
experimental time point or treatment conditions. An investigator could
instead identify the binary comparisons relevant to the biological
question and focus the further classification comparisons to better
select for explanatory features.</p>
<div class="section level4">
<h4 id="multinomial-comparisons">Multinomial comparisons<a class="anchor" aria-label="anchor" href="#multinomial-comparisons"></a>
</h4>
<p>In experiments with more than two classes, multinomial random forest
classification can be used to assess the discrimination between the
classes and give an overview of the relative structure between
classes.</p>
<p>The example data set consists of a total of 6 classes for the
<code>day</code> response variable.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/cls.html">clsExtract</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2 3 4 1 H 5</span></span>
<span><span class="co">#&gt; Levels: 1 2 3 4 5 H</span></span></code></pre></div>
<p>Multinomial classification can be performed by:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multinomial_rf</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/randomForest.html">randomForest</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">multinomial_rf</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random forest classification </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples:  120 </span></span>
<span><span class="co">#&gt; Features:     500 </span></span>
<span><span class="co">#&gt; Response:     day </span></span>
<span><span class="co">#&gt; # comparisons:    1</span></span></code></pre></div>
<p>The performance of this model can be assessed using metrics based on
the success of the out of bag (OOB) predictions. The performance metrics
can be extracted using:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multinomial_rf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/modelling-accessors.html">metrics</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 5</span></span></span>
<span><span class="co">#&gt;   response comparison  .metric  .estimator .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> day      1~2~3~4~5~H accuracy multiclass     0.8  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> day      1~2~3~4~5~H kap      multiclass     0.76 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> day      1~2~3~4~5~H margin   <span style="color: #BB0000;">NA</span>             0.146</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> day      1~2~3~4~5~H roc_auc  hand_till      0.964</span></span></code></pre></div>
<p>These metrics include <strong>accuracy</strong>, <strong>Cohen’s
kappa</strong> (kap), <strong>area under the receiver operator
characteristic curve</strong> (roc_auc, ROC-AUC) and
<strong>margin</strong>. Each metric has both strengths and weaknesses
that depend on the context of the classification such as the balance of
observations between the classes. As shown below, the class frequencies
for this example are balanced with 20 observations per class.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/cls.html">clsExtract</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; .</span></span>
<span><span class="co">#&gt;  1  2  3  4  5  H </span></span>
<span><span class="co">#&gt; 20 20 20 20 20 20</span></span></code></pre></div>
<p>In this context, each of these metrics could be used to assess the
predictive performance of the model. The margin metric is the difference
between the proportion of votes for the correct class and the maximum
proportion of votes for the other classes for a given observation which
is then averaged across all the observations. A positive margin value
indicates correct classification and values greater than 0.2 can be
considered as the models having strong predictive power. The margin also
allows the extent of discrimination to be discerned even in very
distinct cases above where both the accuracy and ROC-AUC would be
registering values of 1.</p>
<p>In this example, the values of all the metrics suggest that the model
is showing good predictive performance. This can be investigated further
by plotting the MDS of observation proximity values.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multinomial_rf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/plotMDS.html">plotMDS</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></span></code></pre></div>
<p><img src="modelling_files/figure-html/multinomial-mds-1.png" width="700" style="display: block; margin: auto;"></p>
<p>This shows that the model is able to discriminate highly between
classes such as <code>5</code> and <code>H</code>. It is less able to
discriminate more similar classes such as <code>H</code> and
<code>1</code> or <code>4</code> and <code>5</code> whose confidence
ellipses show a high degree of overlap. This makes sense in the context
of this experiment as these are adjacent time points that are more
likely to be similar than time points at each end of the experiment.</p>
<p>The ROC curves can also be plotted as shown below.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multinomial_rf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/plotROC.html">plotROC</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="modelling_files/figure-html/multinomial-roc-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Classes with their line further from the central dashed line are
those that were predicted with the greatest reliability by the model.
This plot shows that both the <code>H</code> and <code>1</code> classes
were least reliably predicted which is a result of their close proximity
shown in the MDS plot previously.</p>
<p>Importance metrics can be used to identify the metabolome features
that contribute most to the class discrimination in the model. The
available importance metrics for this model are shown below.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/modelling-accessors.html">importanceMetrics</a></span><span class="op">(</span><span class="va">multinomial_rf</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "1"                    "2"                    "3"                   </span></span>
<span><span class="co">#&gt;  [4] "4"                    "5"                    "false_positive_rate" </span></span>
<span><span class="co">#&gt;  [7] "H"                    "MeanDecreaseAccuracy" "MeanDecreaseGini"    </span></span>
<span><span class="co">#&gt; [10] "selection_frequency"</span></span></code></pre></div>
<p>Here, we will use the false positive rate metric with a threshold of
below 0.05 to identify explanatory features for the <code>day</code>
response variable.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multinomial_rf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/modelling-accessors.html">explanatoryFeatures</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="st">'false_positive_rate'</span>,</span>
<span>                      threshold <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 121 × 5</span></span></span>
<span><span class="co">#&gt;    response comparison  feature metric                 value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> day      1~2~3~4~5~H N341    false_positive_rate 1.02<span style="color: #949494;">e</span><span style="color: #BB0000;">-93</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> day      1~2~3~4~5~H N133    false_positive_rate 7.38<span style="color: #949494;">e</span><span style="color: #BB0000;">-68</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> day      1~2~3~4~5~H N163    false_positive_rate 3.59<span style="color: #949494;">e</span><span style="color: #BB0000;">-61</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> day      1~2~3~4~5~H N439    false_positive_rate 1.07<span style="color: #949494;">e</span><span style="color: #BB0000;">-54</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> day      1~2~3~4~5~H N342    false_positive_rate 3.19<span style="color: #949494;">e</span><span style="color: #BB0000;">-49</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> day      1~2~3~4~5~H N377    false_positive_rate 3.19<span style="color: #949494;">e</span><span style="color: #BB0000;">-49</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> day      1~2~3~4~5~H N171    false_positive_rate 6.26<span style="color: #949494;">e</span><span style="color: #BB0000;">-44</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> day      1~2~3~4~5~H N497    false_positive_rate 6.11<span style="color: #949494;">e</span><span style="color: #BB0000;">-30</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> day      1~2~3~4~5~H N146    false_positive_rate 2.74<span style="color: #949494;">e</span><span style="color: #BB0000;">-29</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> day      1~2~3~4~5~H N195    false_positive_rate 7.16<span style="color: #949494;">e</span><span style="color: #BB0000;">-25</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 111 more rows</span></span></span></code></pre></div>
<p>As shown above there were a total of 121 explanatory features
identified.</p>
<p>Within a multinomial experiment, it is also possible to specify the
exact class comparisons to include, where it might not be suitable to
compare all the classes at once using the <code>comparisons</code>
argument. This should be specified as a named list, the corresponding to
the <code>cls</code> argument. Each named element should then consist of
a vector of comparisons, the classes to compare separated using the
<code>~</code>.</p>
<p>The following specifies two comparisons
(<code>H~1~2</code>,<code>H~1~5</code>) for the <code>day</code>
response variable and displays the performance metrics.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/randomForest.html">randomForest</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,</span>
<span>               comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'H~1~2'</span>,</span>
<span>                                          <span class="st">'H~1~5'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/modelling-accessors.html">metrics</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 5</span></span></span>
<span><span class="co">#&gt;   response comparison .metric  .estimator .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> day      H~1~2      accuracy multiclass     0.833</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> day      H~1~2      kap      multiclass     0.75 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> day      H~1~2      margin   <span style="color: #BB0000;">NA</span>             0.172</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> day      H~1~2      roc_auc  hand_till      0.906</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> day      H~1~5      accuracy multiclass     0.75 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> day      H~1~5      kap      multiclass     0.625</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> day      H~1~5      margin   <span style="color: #BB0000;">NA</span>             0.320</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> day      H~1~5      roc_auc  hand_till      0.909</span></span></code></pre></div>
<p>The MDS and ROC curve plots can also be plotted simultaneously for
the two comparisons.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/randomForest.html">randomForest</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,</span>
<span>               comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'H~1~2'</span>,</span>
<span>                                          <span class="st">'H~1~5'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="op">{</span><span class="fu"><a href="../reference/plotMDS.html">plotMDS</a></span><span class="op">(</span><span class="va">.</span>,cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="../reference/plotROC.html">plotROC</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
<p><img src="modelling_files/figure-html/classification-comparison-mds-roc-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Similarly, it is also possible to model multiple response factors
with a single random forest call by specifying a vector of response
class information column names to the <code>cls</code> argument. In the
following, both the <code>name</code> and <code>day</code> response
factors will be analysed and the performance metrics returned in a
single table.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/randomForest.html">randomForest</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'name'</span>,<span class="st">'day'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/modelling-accessors.html">metrics</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Unbalanced classes detected. Stratifying sample size to the smallest class size.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 5</span></span></span>
<span><span class="co">#&gt;   response comparison                    .metric  .estimator .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> name     11_2~12_2~12_4~13_4~14_4~15_3 accuracy multiclass    0.35  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> name     11_2~12_2~12_4~13_4~14_4~15_3 kap      multiclass    0.212 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> name     11_2~12_2~12_4~13_4~14_4~15_3 margin   <span style="color: #BB0000;">NA</span>           -<span style="color: #BB0000;">0.048</span><span style="color: #BB0000; text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> name     11_2~12_2~12_4~13_4~14_4~15_3 roc_auc  hand_till     0.753 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> day      1~2~3~4~5~H                   accuracy multiclass    0.8   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> day      1~2~3~4~5~H                   kap      multiclass    0.76  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> day      1~2~3~4~5~H                   margin   <span style="color: #BB0000;">NA</span>            0.146 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> day      1~2~3~4~5~H                   roc_auc  hand_till     0.964</span></span></code></pre></div>
<p>The MDS plots can also be returned for both models
simultaneously.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/randomForest.html">randomForest</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'name'</span>,<span class="st">'day'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/plotMDS.html">plotMDS</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Unbalanced classes detected. Stratifying sample size to the smallest class size.</span></span></code></pre></div>
<p><img src="modelling_files/figure-html/multinomial-multiple-mds-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="binary-comparisons">Binary comparisons<a class="anchor" aria-label="anchor" href="#binary-comparisons"></a>
</h4>
<p>It may in some cases be preferable to analyse class comparisons as
multiple binary comparisons.</p>
<p>The possible binary comparisons for a given response variable can be
displayed using the <code><a href="../reference/modelling-accessors.html">binaryComparisons()</a></code> method. Below shows
the 15 comparisons for the <code>day</code> response variable.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/modelling-accessors.html">binaryComparisons</a></span><span class="op">(</span><span class="va">d</span>,cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "1~2" "1~3" "1~4" "1~5" "1~H" "2~3" "2~4" "2~5" "2~H" "3~4" "3~5" "3~H"</span></span>
<span><span class="co">#&gt; [13] "4~5" "4~H" "5~H"</span></span></code></pre></div>
<p>For this example we will only use the binary comparisons containing
the <code>H</code> class.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binary_comparisons</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelling-accessors.html">binaryComparisons</a></span><span class="op">(</span><span class="va">d</span>,cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="va">.</span><span class="op">[</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">.</span>,<span class="st">'H'</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>The binary comparisons can then be performed using the following.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binary_rf</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/randomForest.html">randomForest</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span>,</span>
<span>               comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>day <span class="op">=</span> <span class="va">binary_comparisons</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">binary_rf</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random forest classification </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples:  120 </span></span>
<span><span class="co">#&gt; Features:     500 </span></span>
<span><span class="co">#&gt; Response:     day </span></span>
<span><span class="co">#&gt; # comparisons:    5</span></span></code></pre></div>
<p>To run all possible binary comparisons, the
<code>binary = TRUE</code> argument could instead be used.</p>
<p>The MDS plots for each comparison can be visualised to inspect the
comparisons.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binary_rf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/plotMDS.html">plotMDS</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></span></code></pre></div>
<p><img src="modelling_files/figure-html/binary-mds-1.png" width="700" style="display: block; margin: auto;"></p>
<p>These plots show good separation in all the comparisons except
<code>H~1</code> which is also shown by the plot of the performance
metrics below. Each of the comparisons are showing perfect performance
for the accuracy, Cohen’s kappa and ROC-AUC metrics as well as very high
margin values except for the <code>H~1</code> comparison.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binary_rf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/plotMetrics.html">plotMetrics</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="modelling_files/figure-html/binary-metrics-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The explanatory features for these comparisons can be extracted as
below using the false positive rate metric and a cut-off threshold of
0.05. This gives a total of 251 explanatory features.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binary_rf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/modelling-accessors.html">explanatoryFeatures</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="st">'false_positive_rate'</span>,</span>
<span>                      threshold <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 251 × 5</span></span></span>
<span><span class="co">#&gt;    response comparison feature metric                 value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> day      2~H        N341    false_positive_rate 7.34<span style="color: #949494;">e</span><span style="color: #BB0000;">-52</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> day      2~H        N439    false_positive_rate 1.80<span style="color: #949494;">e</span><span style="color: #BB0000;">-45</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> day      3~H        N342    false_positive_rate 2.71<span style="color: #949494;">e</span><span style="color: #BB0000;">-39</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> day      2~H        N327    false_positive_rate 1.06<span style="color: #949494;">e</span><span style="color: #BB0000;">-35</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> day      3~H        N439    false_positive_rate 1.06<span style="color: #949494;">e</span><span style="color: #BB0000;">-35</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> day      2~H        N477    false_positive_rate 1.60<span style="color: #949494;">e</span><span style="color: #BB0000;">-34</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> day      3~H        N377    false_positive_rate 1.60<span style="color: #949494;">e</span><span style="color: #BB0000;">-34</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> day      4~H        N477    false_positive_rate 7.40<span style="color: #949494;">e</span><span style="color: #BB0000;">-34</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> day      2~H        N447    false_positive_rate 6.48<span style="color: #949494;">e</span><span style="color: #BB0000;">-30</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> day      3~H        N163    false_positive_rate 6.48<span style="color: #949494;">e</span><span style="color: #BB0000;">-30</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 241 more rows</span></span></span></code></pre></div>
<p>A heatmap of these explanatory features can be plotted to show their
mean relative intensities across the experiment time points. Here, the
classes are also refactored to customise the order of the classes on the
x-axis.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">refactor_cls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cls.html">clsExtract</a></span><span class="op">(</span><span class="va">binary_rf</span>,</span>
<span>                           cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">.</span>,levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'H'</span>,<span class="st">'1'</span>,<span class="st">'2'</span>,<span class="st">'3'</span>,<span class="st">'4'</span>,<span class="st">'5'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">binary_rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cls.html">clsReplace</a></span><span class="op">(</span><span class="va">binary_rf</span>,</span>
<span>                        value <span class="op">=</span> <span class="va">refactor_cls</span>,</span>
<span>                        cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></span>
<span><span class="va">binary_rf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/plotExplanatoryHeatmap.html">plotExplanatoryHeatmap</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="st">'false_positive_rate'</span>,</span>
<span>                      threshold <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                      featureNames <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="modelling_files/figure-html/binary-heatmap-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level3">
<h3 id="regression">Regression<a class="anchor" aria-label="anchor" href="#regression"></a>
</h3>
<p>Random forest regression can be used to assess the extent of
association of the metabolomic data with continuous response
variables.</p>
<p>In this example, the extent of association of injection order with
the example data will be assessed.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regression_rf</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/randomForest.html">randomForest</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="st">'injorder'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">regression_rf</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random forest regression </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples:  120 </span></span>
<span><span class="co">#&gt; Features:     500 </span></span>
<span><span class="co">#&gt; Response:     injorder</span></span></code></pre></div>
<p>The regression model performance metrics, based on the OOB prediction
error, can be extracted using the following:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regression_rf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/modelling-accessors.html">metrics</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 4</span></span></span>
<span><span class="co">#&gt;   response .metric .estimator .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> injorder ccc     standard       0.513</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> injorder mae     standard      23.5  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> injorder mape    standard     154.   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> injorder rmse    standard      26.5  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> injorder rsq     standard       0.476</span></span></code></pre></div>
<p>These regression metrics include <strong>R<sup>2</sup></strong>
(<code>rsq</code>), <strong>mean absolute error</strong>
(<code>mae</code>), <strong>mean absolute percentage error</strong>
(<code>mape</code>), <strong>root mean squared error</strong>
(<code>rmse</code>) and the <strong>concordance correlation
coefficient</strong> (<code>ccc</code>).</p>
<p>The R<sup>2</sup> and concordance correlation coefficient metrics
suggest that there is some association of features with the injection
order, although this is weak. This is in agreement with mean absolute
error metric that shows that on average, the injection order could only
be predicted to an accuracy of 23 injection order positions.</p>
<p>The MDS plot belows the relative proximities of the samples based on
this injection order regression model. This shows that for the most
part, there is little correspondence of the sample positions with their
injection order. However, there is a small grouping of samples towards
the end of the run around sample ~99 to 120. It suggests that there
could have been some analytical issues, for certain features, towards
the end of the mass spectral analytical run.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regression_rf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/plotMDS.html">plotMDS</a></span><span class="op">(</span>cls <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>          ellipses <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          label <span class="op">=</span> <span class="st">'injorder'</span>,</span>
<span>          labelSize <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="modelling_files/figure-html/regression-mds-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The available feature importance metrics for this regression model
can be listed.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regression_rf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/modelling-accessors.html">importanceMetrics</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "%IncMSE"       "IncNodePurity"</span></span></code></pre></div>
<p>The feature importance metrics can be plotted to give an overview of
their distribution. The following will plot the <strong>percentage
increase in the mean squared error</strong> (<code>%IncMSE</code>)
importance metric.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regression_rf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/plotImportance.html">plotImportance</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="st">"%IncMSE"</span>, </span>
<span>                 rank <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="modelling_files/figure-html/regression-importance-plot-1.png" width="700" style="display: block; margin: auto;"></p>
<p>This shows that there are only a few features that are contributing
to the association with injection order. These explanatory features can
be extracted with the following, using a threshold of above 5.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regression_rf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/modelling-accessors.html">explanatoryFeatures</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="st">'%IncMSE'</span>,</span>
<span>                      threshold <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 4</span></span></span>
<span><span class="co">#&gt;   response feature metric  value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> injorder N283    %IncMSE 19.9 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> injorder N135    %IncMSE  8.71</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> injorder N451    %IncMSE  5.58</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> injorder N161    %IncMSE  5.51</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> injorder N306    %IncMSE  5.49</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> injorder N118    %IncMSE  5.22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> injorder N297    %IncMSE  5.07</span></span></code></pre></div>
<p>This returned a total of 7 explanatory features above this threshold.
The top ranked feature <code>N283</code> can be plotted to investigate
it’s trend in relation to injection order.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regression_rf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/plotFeature.html">plotFeature</a></span><span class="op">(</span>feature <span class="op">=</span> <span class="st">'N283'</span>,</span>
<span>              cls <span class="op">=</span> <span class="st">'injorder'</span><span class="op">)</span></span></code></pre></div>
<p><img src="modelling_files/figure-html/regression-feature-1.png" width="700" style="display: block; margin: auto;"></p>
<p>This shows an increase in the intensity of that feature for samples
above 100 in the injection order which corresponds with the cluster that
was seen in the MDS plot above.</p>
</div>
</div>
<div class="section level2">
<h2 id="univariate-analyses">Univariate analyses<a class="anchor" aria-label="anchor" href="#univariate-analyses"></a>
</h2>
<p>Univariate methods select features, explanatory for response
variables, with features tested on an individual basis. These methods
offer simplicity and easy interpretation in their use, however they
provide no information as to how features may interact.</p>
<p>The univariate methods currently available in
<code>metabolyseR</code> include Welch’s t-test, analysis of variance
(ANOVA) and linear regression. The following sections will provide brief
examples of the use of each of these methods.</p>
<div class="section level3">
<h3 id="welchs-t-test">Welch’s t-test<a class="anchor" aria-label="anchor" href="#welchs-t-test"></a>
</h3>
<p>Welch’s t-test can be used to select explanatory metabolome features
for binary comparisons of discrete variables. By default, all the
possible binary comparisons for the categories of a response variable
will be tested.</p>
<p>Below shows the possible binary comparisons for the <code>day</code>
response variable for the example data set.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/modelling-accessors.html">binaryComparisons</a></span><span class="op">(</span><span class="va">d</span>,</span>
<span>                  cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "1~2" "1~3" "1~4" "1~5" "1~H" "2~3" "2~4" "2~5" "2~H" "3~4" "3~5" "3~H"</span></span>
<span><span class="co">#&gt; [13] "4~5" "4~H" "5~H"</span></span></code></pre></div>
<p>For the following example, only a subset of comparisons will be
tested. These will be selected by supplying a list to the
<code>comparisons</code> argument.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ttest_analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ttest.html">ttest</a></span><span class="op">(</span><span class="va">d</span>,</span>
<span>                        cls <span class="op">=</span> <span class="st">'day'</span>,</span>
<span>                        comparisons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'H~1'</span>,</span>
<span>                                                   <span class="st">'H~2'</span>,</span>
<span>                                                   <span class="st">'H~5'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ttest_analysis</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Univariate t-test analysis</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples:  120 </span></span>
<span><span class="co">#&gt; Features:     500 </span></span>
<span><span class="co">#&gt; Responses:    day </span></span>
<span><span class="co">#&gt; # comparisons:    3</span></span></code></pre></div>
<p>The explanatory features that show a significant difference between
the response categories can be extracted as shown below.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/modelling-accessors.html">explanatoryFeatures</a></span><span class="op">(</span><span class="va">ttest_analysis</span>,</span>
<span>                    threshold <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 73 × 14</span></span></span>
<span><span class="co">#&gt;    response comparison feature estimate estimate1 estimate2 statistic  p.value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> day      H~5        N163      -<span style="color: #BB0000;">735.</span>       19.5   755.       -<span style="color: #BB0000;">13.8</span>  1.43<span style="color: #949494;">e</span><span style="color: #BB0000;">-11</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> day      H~5        N341      <span style="text-decoration: underline;">2</span>445.     <span style="text-decoration: underline;">2</span>537.     92.6       13.6  2.88<span style="color: #949494;">e</span><span style="color: #BB0000;">-11</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> day      H~5        N133      <span style="text-decoration: underline;">1</span>055.     <span style="text-decoration: underline;">1</span>077.     21.9       13.0  5.44<span style="color: #949494;">e</span><span style="color: #BB0000;">-11</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> day      H~2        N341       200.      293.     92.6       10.6  1.38<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> day      H~5        N171        62.6      64.7     2.15      11.9  2.62<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> day      H~5        N119        17.2      17.9     0.763     11.0  8.54<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> day      H~5        N342       243.      247.      4.13      10.8  1.42<span style="color: #949494;">e</span><span style="color: #BB0000;">- 9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> day      H~5        N343        27.4      28.3     0.961      9.83 5.99<span style="color: #949494;">e</span><span style="color: #BB0000;">- 9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> day      H~5        N377       152.      157.      5.05       9.81 6.75<span style="color: #949494;">e</span><span style="color: #BB0000;">- 9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> day      H~5        N477       103.      129.     26.1        9.30 1.05<span style="color: #949494;">e</span><span style="color: #BB0000;">- 8</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 63 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: parameter &lt;dbl&gt;, conf.low &lt;dbl&gt;, conf.high &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   method &lt;chr&gt;, alternative &lt;chr&gt;, adjusted.p.value &lt;dbl&gt;</span></span></span></code></pre></div>
<p>This will threshold the features based on their adjusted p-value,
found in the <code>adjusted.p.value</code> column of the table. The
results of all of the features can be returned using the
<code><a href="../reference/modelling-accessors.html">importance()</a></code> method.</p>
<p>A heat map of the explanatory features can be plotted to inspect the
relative trends of the explanatory features in relation to the response
<code>variable</code>.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotExplanatoryHeatmap.html">plotExplanatoryHeatmap</a></span><span class="op">(</span><span class="va">ttest_analysis</span><span class="op">)</span></span></code></pre></div>
<p><img src="modelling_files/figure-html/t-test-heatmap-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="anova">ANOVA<a class="anchor" aria-label="anchor" href="#anova"></a>
</h3>
<p>ANOVA can be used to select explanatory features for discrete
response variables with 3 or more categories. The following example will
compare all the categories in the <code>day</code> response variable.
However, the <code>comparisons</code> argument can be used to select
particular comparisons of interest.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anova_analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/anova.html">anova</a></span><span class="op">(</span><span class="va">d</span>,</span>
<span>                        cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">anova_analysis</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Univariate ANOVA analysis</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples:  120 </span></span>
<span><span class="co">#&gt; Features:     500 </span></span>
<span><span class="co">#&gt; Responses:    day </span></span>
<span><span class="co">#&gt; # comparisons:    1</span></span></code></pre></div>
<p>The explanatory features that are significantly different between the
categories can then be extracted.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/modelling-accessors.html">explanatoryFeatures</a></span><span class="op">(</span><span class="va">anova_analysis</span>,</span>
<span>                    threshold <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 110 × 10</span></span></span>
<span><span class="co">#&gt;    response comparison  feature term        df   sumsq meansq statistic  p.value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> day      1~2~3~4~5~H N341    response     5  1.09<span style="color: #949494;">e</span>8 2.17<span style="color: #949494;">e</span>7     124.  1.90<span style="color: #949494;">e</span><span style="color: #BB0000;">-44</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> day      1~2~3~4~5~H N163    response     5  1.25<span style="color: #949494;">e</span>7 2.51<span style="color: #949494;">e</span>6     113.  1.71<span style="color: #949494;">e</span><span style="color: #BB0000;">-42</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> day      1~2~3~4~5~H N133    response     5  1.96<span style="color: #949494;">e</span>7 3.92<span style="color: #949494;">e</span>6     108.  1.71<span style="color: #949494;">e</span><span style="color: #BB0000;">-41</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> day      1~2~3~4~5~H N171    response     5  6.29<span style="color: #949494;">e</span>4 1.26<span style="color: #949494;">e</span>4      88.8 1.16<span style="color: #949494;">e</span><span style="color: #BB0000;">-37</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> day      1~2~3~4~5~H N342    response     5  1.04<span style="color: #949494;">e</span>6 2.07<span style="color: #949494;">e</span>5      85.1 7.61<span style="color: #949494;">e</span><span style="color: #BB0000;">-37</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> day      1~2~3~4~5~H N343    response     5  1.19<span style="color: #949494;">e</span>4 2.38<span style="color: #949494;">e</span>3      66.1 4.43<span style="color: #949494;">e</span><span style="color: #BB0000;">-32</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> day      1~2~3~4~5~H N119    response     5  4.92<span style="color: #949494;">e</span>3 9.83<span style="color: #949494;">e</span>2      53.8 2.07<span style="color: #949494;">e</span><span style="color: #BB0000;">-28</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> day      1~2~3~4~5~H N497    response     5  1.10<span style="color: #949494;">e</span>5 2.20<span style="color: #949494;">e</span>4      49.6 4.83<span style="color: #949494;">e</span><span style="color: #BB0000;">-27</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> day      1~2~3~4~5~H N137    response     5  6.32<span style="color: #949494;">e</span>3 1.26<span style="color: #949494;">e</span>3      39.9 1.59<span style="color: #949494;">e</span><span style="color: #BB0000;">-23</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> day      1~2~3~4~5~H N277    response     5  6.31<span style="color: #949494;">e</span>4 1.26<span style="color: #949494;">e</span>4      39.1 3.14<span style="color: #949494;">e</span><span style="color: #BB0000;">-23</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 100 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: adjusted.p.value &lt;dbl&gt;</span></span></span></code></pre></div>
<p>The top ranked explanatory feature <code>N341</code> can be plotted
to inspect it’s trend relative to the <code>day</code> response
variable.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotFeature.html">plotFeature</a></span><span class="op">(</span><span class="va">anova_analysis</span>,</span>
<span>            feature <span class="op">=</span> <span class="st">'N341'</span>,</span>
<span>            cls <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span></span></code></pre></div>
<p><img src="modelling_files/figure-html/anova-feature-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="linear-regression">Linear regression<a class="anchor" aria-label="anchor" href="#linear-regression"></a>
</h3>
<p>Univariate linear regression can be used to associate a continuous
response variable with metabolome features. In the example below, the
example data will be regressed against injection order to identify any
linearly associated metabolome features.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lr_analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/linearRegression.html">linearRegression</a></span><span class="op">(</span><span class="va">d</span>,</span>
<span>                                cls <span class="op">=</span> <span class="st">'injorder'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">lr_analysis</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Univariate linear regression analysis</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples:  120 </span></span>
<span><span class="co">#&gt; Features:     500 </span></span>
<span><span class="co">#&gt; Responses:    injorder</span></span></code></pre></div>
<p>The explanatory features can then be extracted.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/modelling-accessors.html">explanatoryFeatures</a></span><span class="op">(</span><span class="va">lr_analysis</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 15</span></span></span>
<span><span class="co">#&gt;   response feature r.squared adj.r.squared sigma statistic  p.value    df logLik</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> injorder N283        0.310         0.304  4.27      53.0 4.10<span style="color: #949494;">e</span><span style="color: #BB0000;">-11</span>     1  -<span style="color: #BB0000;">343.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> injorder N135        0.165         0.157 78.7       23.2 4.31<span style="color: #949494;">e</span><span style="color: #BB0000;">- 6</span>     1  -<span style="color: #BB0000;">693.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> injorder N221        0.140         0.133  5.87      19.3 2.50<span style="color: #949494;">e</span><span style="color: #BB0000;">- 5</span>     1  -<span style="color: #BB0000;">382.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> injorder N473        0.135         0.127  7.24      18.3 3.78<span style="color: #949494;">e</span><span style="color: #BB0000;">- 5</span>     1  -<span style="color: #BB0000;">407.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> injorder N335        0.132         0.124 20.1       17.9 4.59<span style="color: #949494;">e</span><span style="color: #BB0000;">- 5</span>     1  -<span style="color: #BB0000;">529.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> injorder N452        0.120         0.112  4.00      16.0 1.10<span style="color: #949494;">e</span><span style="color: #BB0000;">- 4</span>     1  -<span style="color: #BB0000;">335.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> injorder N255        0.119         0.111 11.1       15.9 1.17<span style="color: #949494;">e</span><span style="color: #BB0000;">- 4</span>     1  -<span style="color: #BB0000;">458.</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> injorder N267        0.118         0.111 26.4       15.8 1.22<span style="color: #949494;">e</span><span style="color: #BB0000;">- 4</span>     1  -<span style="color: #BB0000;">562.</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: AIC &lt;dbl&gt;, BIC &lt;dbl&gt;, deviance &lt;dbl&gt;, df.residual &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   nobs &lt;int&gt;, adjusted.p.value &lt;dbl&gt;</span></span></span></code></pre></div>
<p>The top ranked explanatory feature <code>N283</code> can be plotted
to inspect inspects it’s association with injection order.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotFeature.html">plotFeature</a></span><span class="op">(</span><span class="va">lr_analysis</span>,</span>
<span>            feature <span class="op">=</span> <span class="st">'N283'</span>,</span>
<span>            cls <span class="op">=</span> <span class="st">'injorder'</span><span class="op">)</span></span></code></pre></div>
<p><img src="modelling_files/figure-html/linear-regression-feature-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="routine-analyses">Routine analyses<a class="anchor" aria-label="anchor" href="#routine-analyses"></a>
</h2>
<p>For routine analyses, the initial analysis parameters for
pre-treatment of the data and then the modelling can be selected.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analysisParameters.html">analysisParameters</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'pre-treatment'</span>,<span class="st">'modelling'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>More specific parameters for pre-treatment of the example data can be
declared using the following.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/parameters.html">parameters</a></span><span class="op">(</span><span class="va">p</span>,<span class="st">'pre-treatment'</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pre-treatment-parameters.html">preTreatmentParameters</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    keep <span class="op">=</span> <span class="st">'classes'</span>,</span>
<span>    occupancyFilter <span class="op">=</span> <span class="st">'maximum'</span>,</span>
<span>    transform <span class="op">=</span> <span class="st">'TICnorm'</span> </span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/modelling-parameters.html">modellingMethods()</a></code> function can be used to list the
modelling methods that are currently available in
<code>metabolyseR</code>.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/modelling-parameters.html">modellingMethods</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "anova"            "ttest"            "linearRegression" "randomForest"</span></span></code></pre></div>
<p>The <code><a href="../reference/modelling-parameters.html">modellingParameters()</a></code> function can be used to
retrieve the default parameters for specific modelling methods. Below,
the default modelling parameters for the <code>randomForest</code> and
<code>ttest</code> methods are specified.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/parameters.html">parameters</a></span><span class="op">(</span><span class="va">p</span>,<span class="st">'modelling'</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelling-parameters.html">modellingParameters</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'randomForest'</span>,<span class="st">'ttest'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The class parameters can the be universily specified for both the
pre-treatment and modelling elements. For this example, the
<code>day</code> response variable will be used with just the
<code>H</code> and <code>2</code> classes.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">changeParameter</span><span class="op">(</span><span class="va">p</span>,<span class="st">'cls'</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'day'</span></span>
<span><span class="fu">changeParameter</span><span class="op">(</span><span class="va">p</span>,<span class="st">'classes'</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'H'</span>,<span class="st">'2'</span><span class="op">)</span></span></code></pre></div>
<p>This gives the following parameters for the analysis.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">Parameters:</span></span></span>
<span><span class="co">#&gt; pre-treatment</span></span>
<span><span class="co">#&gt;  keep</span></span>
<span><span class="co">#&gt;      classes</span></span>
<span><span class="co">#&gt;          cls = day</span></span>
<span><span class="co">#&gt;          classes = c("H", "2")</span></span>
<span><span class="co">#&gt;  occupancyFilter</span></span>
<span><span class="co">#&gt;      maximum</span></span>
<span><span class="co">#&gt;          cls = day</span></span>
<span><span class="co">#&gt;          occupancy = 2/3</span></span>
<span><span class="co">#&gt;  transform</span></span>
<span><span class="co">#&gt;      TICnorm</span></span>
<span><span class="co">#&gt;          refactor = TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; modelling</span></span>
<span><span class="co">#&gt;  randomForest</span></span>
<span><span class="co">#&gt;      cls = day</span></span>
<span><span class="co">#&gt;      rf = list()</span></span>
<span><span class="co">#&gt;      reps = 1</span></span>
<span><span class="co">#&gt;      binary = FALSE</span></span>
<span><span class="co">#&gt;      comparisons = list()</span></span>
<span><span class="co">#&gt;      perm = 0</span></span>
<span><span class="co">#&gt;      returnModels = FALSE</span></span>
<span><span class="co">#&gt;      seed = 1234</span></span>
<span><span class="co">#&gt;  ttest</span></span>
<span><span class="co">#&gt;      cls = day</span></span>
<span><span class="co">#&gt;      pAdjust = bonferroni</span></span>
<span><span class="co">#&gt;      comparisons = list()</span></span>
<span><span class="co">#&gt;      returnModels = FALSE</span></span></code></pre></div>
<p>The analysis can then be executed.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>analysis <span class="ot">&lt;-</span> <span class="fu">metabolyse</span>(abr1<span class="sc">$</span>neg,abr1<span class="sc">$</span>fact,p)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [34m</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; metabolyseR  [39m  [31mv0.15.2 [39m Mon Aug 14 15:19:00 2023</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [33m [33mParameters: [33m [39m</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; pre-treatment</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  keep</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      classes</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          cls = day</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          classes = c("H", "2")</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  occupancyFilter</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      maximum</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          cls = day</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          occupancy = 2/3</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  transform</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      TICnorm</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          refactor = TRUE</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; modelling</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  randomForest</span></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      cls = day</span></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      rf = list()</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      reps = 1</span></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      binary = FALSE</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      comparisons = list()</span></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      perm = 0</span></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      returnModels = FALSE</span></span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      seed = 1234</span></span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  ttest</span></span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      cls = day</span></span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      pAdjust = bonferroni</span></span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      comparisons = list()</span></span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      returnModels = FALSE</span></span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [34mPre-treatment  [39m…</span></span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a> [34mPre<span class="sc">-</span>treatment  [39m     [32m✔ [39m [<span class="fl">0.5</span>S]</span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [34mModelling  [39m…</span></span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a> [34m</span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>Modelling  [39m  [32m✔ [39m [<span class="fl">10.1</span>S]</span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ________________________________________________________________________________</span></span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [32mComplete!  [39m[10.6S]</span></span></code></pre></div>
<p>The results for the modelling can be specifically extracted using the
following.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/analysis-accessors.html">analysisResults</a></span><span class="op">(</span><span class="va">analysis</span>,<span class="st">'modelling'</span><span class="op">)</span></span>
<span><span class="co">#&gt; $randomForest</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random forest classification </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples:  40 </span></span>
<span><span class="co">#&gt; Features:     1713 </span></span>
<span><span class="co">#&gt; Response:     day </span></span>
<span><span class="co">#&gt; # comparisons:    1 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ttest</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Univariate t-test analysis</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples:  40 </span></span>
<span><span class="co">#&gt; Features:     1713 </span></span>
<span><span class="co">#&gt; Responses:    day </span></span>
<span><span class="co">#&gt; # comparisons:    1</span></span></code></pre></div>
<p>This returns the results as a list containing the modelling results
objects for each specified method.</p>
<p>Alternatively, the modelling results can be assess directly from the
<code>Analysis</code> object. Below shows the extraction of the
explanatory features, using default parameters for each method, with the
results returned in a single table.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">explanatory_features</span> <span class="op">&lt;-</span> <span class="va">analysis</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/modelling-accessors.html">explanatoryFeatures</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">explanatory_features</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 100 × 17</span></span></span>
<span><span class="co">#&gt;    Method       response comparison feature metric      value estimate estimate1</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> randomForest day      2~H        N341    false_p… 8.06<span style="color: #949494;">e</span><span style="color: #BB0000;">-28</span>       <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> randomForest day      2~H        N377    false_p… 5.70<span style="color: #949494;">e</span><span style="color: #BB0000;">-18</span>       <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> randomForest day      2~H        N447    false_p… 5.70<span style="color: #949494;">e</span><span style="color: #BB0000;">-18</span>       <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> randomForest day      2~H        N579    false_p… 5.70<span style="color: #949494;">e</span><span style="color: #BB0000;">-18</span>       <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> randomForest day      2~H        N1084   false_p… 1.19<span style="color: #949494;">e</span><span style="color: #BB0000;">-16</span>       <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> randomForest day      2~H        N327    false_p… 2.33<span style="color: #949494;">e</span><span style="color: #BB0000;">-15</span>       <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> randomForest day      2~H        N580    false_p… 4.32<span style="color: #949494;">e</span><span style="color: #BB0000;">-14</span>       <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> randomForest day      2~H        N1083   false_p… 7.49<span style="color: #949494;">e</span><span style="color: #BB0000;">-13</span>       <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> randomForest day      2~H        N1085   false_p… 7.49<span style="color: #949494;">e</span><span style="color: #BB0000;">-13</span>       <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> randomForest day      2~H        N503    false_p… 7.49<span style="color: #949494;">e</span><span style="color: #BB0000;">-13</span>       <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 90 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 9 more variables: estimate2 &lt;dbl&gt;, statistic &lt;dbl&gt;, p.value &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   parameter &lt;dbl&gt;, conf.low &lt;dbl&gt;, conf.high &lt;dbl&gt;, method &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   alternative &lt;chr&gt;, adjusted.p.value &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Heat maps of the explanatory features can also be plotted for both
the modelling methods.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotExplanatoryHeatmap.html">plotExplanatoryHeatmap</a></span><span class="op">(</span><span class="va">analysis</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="modelling_files/figure-html/explanatory-heatmap-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jasen Finch.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
